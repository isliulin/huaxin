###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.4.40412/W32 for 8051         19/Jun/2016  18:15:58 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\freeman\Documents\work\SN\module\Componen #
#                          ts\usb\class_cdc\FAT.C                             #
#    Command line       =  -f "C:\Users\freeman\Documents\work\SN\module\Proj #
#                          ects\zstack\Samples\SampleApp                      #
#                          com\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg #
#                          " (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR    #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF0                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440)   #
#                          C:\Users\freeman\Documents\work\SN\module\Componen #
#                          ts\usb\class_cdc\FAT.C -D ZIGBEEPRO -D ZTOOL_P1    #
#                          -lC "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\CoordinatorEB-Pro\List\" -lA          #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\CoordinatorEB-Pro\List\"              #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\CoordinatorEB-Pro\Obj\" -e --debug    #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Users\freeman\Document #
#                          s\work\SN\module\Projects\zstack\Samples\SampleApp #
#                           com\CC2530DB\" -I "C:\Users\freeman\Documents\wor #
#                          k\SN\module\Projects\zstack\Samples\SampleApp      #
#                          com\CC2530DB\..\SOURCE\" -I                        #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I          #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MT\" -I     #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE #
#                          \" -I "C:\Users\freeman\Documents\work\SN\module\P #
#                          rojects\zstack\Samples\SampleApp                   #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\ #
#                          CC2530EB\" -I "C:\Users\freeman\Documents\work\SN\ #
#                          module\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CC #
#                          SOC\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUD #
#                          E\" -I "C:\Users\freeman\Documents\work\SN\module\ #
#                          Projects\zstack\Samples\SampleApp                  #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF\"  #
#                          -I "C:\Users\freeman\Documents\work\SN\module\Proj #
#                          ects\zstack\Samples\SampleApp                      #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ #
#                          " -I "C:\Users\freeman\Documents\work\SN\module\Pr #
#                          ojects\zstack\Samples\SampleApp                    #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\"  #
#                          -I "C:\Users\freeman\Documents\work\SN\module\Proj #
#                          ects\zstack\Samples\SampleApp                      #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I   #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SA #
#                          DDR\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SD #
#                          ATA\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE #
#                          \" -I "C:\Users\freeman\Documents\work\SN\module\P #
#                          rojects\zstack\Samples\SampleApp                   #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LE #
#                          VEL\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\srf04\" -I "C:\Users\freeman\Documents\work\SN\ #
#                          module\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\srf04\SINGLE_CHIP\" -I                          #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\usb\library #
#                          \" -I "C:\Users\freeman\Documents\work\SN\module\P #
#                          rojects\zstack\Samples\SampleApp                   #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\usb\class_h #
#                          id\" -I "C:\Users\freeman\Documents\work\SN\module #
#                          \Projects\zstack\Samples\SampleApp                 #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\hal\common\ #
#                          " -Ohz --require_prototypes                        #
#    List file          =  C:\Users\freeman\Documents\work\SN\module\Projects #
#                          \zstack\Samples\SampleApp                          #
#                          com\CC2530DB\CoordinatorEB-Pro\List\FAT.lst        #
#    Object file        =  C:\Users\freeman\Documents\work\SN\module\Projects #
#                          \zstack\Samples\SampleApp                          #
#                          com\CC2530DB\CoordinatorEB-Pro\Obj\FAT.r51         #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\freeman\Documents\work\SN\module\Components\usb\class_cdc\FAT.C
      1          /******************************************************************
      2             本程序只供学习使用，未经作者许可，不得用于其它任何用途
      3          			
      4                  欢迎访问我的USB专区：http://group.ednchina.com/93/
      5                  欢迎访问我的blog：   http://www.ednchina.com/blog/computer00
      6                                       http://computer00.21ic.org
      7          
      8                  感谢PCB赞助商――电子园： http://bbs.cepark.com/
      9          
     10          FAT.c file
     11          
     12          作者：电脑圈圈
     13          建立日期: 2008.08.19
     14          修改日期: 2008.08.20
     15          版本：V1.1
     16          版权所有，盗版必究。
     17          Copyright(C) 电脑圈圈 2008-2018
     18          All rights reserved            
     19          *******************************************************************/
     20          
     21          #include "FAT.h"
     22          
     23          
     24          #if 0
     25          uint32_t MassBlock[MASS_BUFFER_SIZE / 4];
     26          uint32_t Storage_Block[STORAGE_BUFFER_SIZE / 4];
     27          
     28          const uint8_t u8FormatData[62] = 
     29          {
     30              0xEB, 0x3C, 0x90, 0x4D, 0x53, 0x44, 0x4F, 0x53,
     31              0x35, 0x2E, 0x30, 0x00, 0x02, 0x01, 0x06, 0x00,
     32              0x02, 0x00, 0x02, 0xA8, 0x00, 0xF8, 0x01, 0x00,
     33              0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
     34              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x29, 0xB9,
     35              0xC1, 0xAA, 0x42, 0x4E, 0x4F, 0x20, 0x4E, 0x41,
     36              0x4D, 0x45, 0x20, 0x20, 0x20, 0x20, 0x46, 0x41,
     37              0x54, 0x31, 0x32, 0x20, 0x20, 0x20
     38          };
     39          
     40          
     41          const uint8_t u8RootDirData[96] = 
     42          {
     43              0x42, 0x20, 0x00, 0x49, 0x00, 0x6E, 0x00, 0x66,
     44              0x00, 0x6F, 0x00, 0x0F, 0x00, 0x72, 0x72, 0x00,
     45              0x6D, 0x00, 0x61, 0x00, 0x74, 0x00, 0x69, 0x00,
     46              0x6F, 0x00, 0x00, 0x00, 0x6E, 0x00, 0x00, 0x00,
     47              0x01, 0x53, 0x00, 0x79, 0x00, 0x73, 0x00, 0x74,
     48              0x00, 0x65, 0x00, 0x0F, 0x00, 0x72, 0x6D, 0x00,
     49              0x20, 0x00, 0x56, 0x00, 0x6F, 0x00, 0x6C, 0x00,
     50              0x75, 0x00, 0x00, 0x00, 0x6D, 0x00, 0x65, 0x00,
     51              0x53, 0x59, 0x53, 0x54, 0x45, 0x4D, 0x7E, 0x31,
     52              0x20, 0x20, 0x20, 0x16, 0x00, 0x99, 0x0D, 0x5C,
     53              0x6D, 0x43, 0x6D, 0x43, 0x00, 0x00, 0x0E, 0x5C,
     54              0x6D, 0x43, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00,
     55          };
     56          
     57          
     58          void my_memcpy(void *dest, void *src, int32_t size)
     59          {
     60              int32_t i;
     61          
     62              for (i = 0; i < size; i++)
     63                 *((uint8_t *)dest + i) = *((uint8_t *)src + i);
     64          }
     65          
     66          void FMC_ReadPage(uint32_t u32startAddr, uint32_t * u32buff)
     67          {
     68              uint32_t i;
     69                 
     70              for (i = 0; i < FLASH_PAGE_SIZE/4; i++)
     71              {
     72                  u32buff[i] = 0;
     73              }                
     74          
     75              if (u32startAddr == 0x00000000)
     76              {
     77                  my_memcpy((uint8_t *)u32buff, (uint8_t *)u8FormatData, 62);
     78                  
     79                  u32buff[FLASH_PAGE_SIZE/4-1] = 0xAA550000;            
     80              }
     81              else
     82              {
     83                  if ( (u32startAddr == (FAT_SECTORS * 512)) || (u32startAddr == ((FAT_SECTORS+1) * 512)) )
     84                  {
     85                      u32buff[0] = 0x00FFFFF8;
     86                  }
     87                  else if (u32startAddr == (8 * 512)) /* root dir */
     88                  {
     89                      my_memcpy((uint8_t *)u32buff, (uint8_t *)u8RootDirData, 96);
     90                  }
     91              }
     92          }
     93          
     94          #else
     95          //DBR（DOS引导记录）

   \                                 In  segment XDATA_ROM_C, align 1
     96          const uint8 Dbr[512]=
   \                     Dbr:
   \   000000   EB           DB 235
   \   000001   3E           DB 62
   \   000002   90           DB 144
   \   000003   4D           DB 77
   \   000004   53           DB 83
   \   000005   44           DB 68
   \   000006   4F           DB 79
   \   000007   53           DB 83
   \   000008   35           DB 53
   \   000009   2E           DB 46
   \   00000A   30           DB 48
   \   00000B   00           DB 0
   \   00000C   02           DB 2
   \   00000D   20           DB 32
   \   00000E   01           DB 1
   \   00000F   00           DB 0
   \   000010   02           DB 2
   \   000011   00           DB 0
   \   000012   02           DB 2
   \   000013   00           DB 0
   \   000014   00           DB 0
   \   000015   F8           DB 248
   \   000016   20           DB 32
   \   000017   00           DB 0
   \   000018   20           DB 32
   \   000019   00           DB 0
   \   00001A   40           DB 64
   \   00001B   00           DB 0
   \   00001C   00           DB 0
   \   00001D   00           DB 0
   \   00001E   00           DB 0
   \   00001F   00           DB 0
   \   000020   00           DB 0
   \   000021   00           DB 0
   \   000022   04           DB 4
   \   000023   00           DB 0
   \   000024   80           DB 128
   \   000025   00           DB 0
   \   000026   29           DB 41
   \   000027   88           DB 136
   \   000028   09           DB 9
   \   000029   71           DB 113
   \   00002A   20           DB 32
   \   00002B   C9           DB 201
   \   00002C   E8           DB 232
   \   00002D   B1           DB 177
   \   00002E   B8           DB 184
   \   00002F   C9           DB 201
   \   000030   FD           DB 253
   \   000031   BC           DB 188
   \   000032   B6           DB 182
   \   000033   55           DB 85
   \   000034   C5           DB 197
   \   000035   CC           DB 204
   \   000036   46           DB 70
   \   000037   41           DB 65
   \   000038   54           DB 84
   \   000039   31           DB 49
   \   00003A   36           DB 54
   \   00003B   20           DB 32
   \   00003C   20           DB 32
   \   00003D   20           DB 32
   \   00003E   F1           DB 241
   \   00003F   7D           DB 125
   \   000040   FA           DB 250
   \   000041   33           DB 51
   \   000042   C9           DB 201
   \   000043   8E           DB 142
   \   000044   D1           DB 209
   \   000045   BC           DB 188
   \   000046   FC           DB 252
   \   000047   7B           DB 123
   \   000048   16           DB 22
   \   000049   07           DB 7
   \   00004A   BD           DB 189
   \   00004B   78           DB 120
   \   00004C   00           DB 0
   \   00004D   C5           DB 197
   \   00004E   76           DB 118
   \   00004F   00           DB 0
   \   000050   1E           DB 30
   \   000051   56           DB 86
   \   000052   16           DB 22
   \   000053   55           DB 85
   \   000054   BF           DB 191
   \   000055   22           DB 34
   \   000056   05           DB 5
   \   000057   89           DB 137
   \   000058   7E           DB 126
   \   000059   00           DB 0
   \   00005A   89           DB 137
   \   00005B   4E           DB 78
   \   00005C   02           DB 2
   \   00005D   B1           DB 177
   \   00005E   0B           DB 11
   \   00005F   FC           DB 252
   \   000060   F3           DB 243
   \   000061   A4           DB 164
   \   000062   06           DB 6
   \   000063   1F           DB 31
   \   000064   BD           DB 189
   \   000065   00           DB 0
   \   000066   7C           DB 124
   \   000067   C6           DB 198
   \   000068   45           DB 69
   \   000069   FE           DB 254
   \   00006A   0F           DB 15
   \   00006B   8B           DB 139
   \   00006C   46           DB 70
   \   00006D   18           DB 24
   \   00006E   88           DB 136
   \   00006F   45           DB 69
   \   000070   F9           DB 249
   \   000071   FB           DB 251
   \   000072   38           DB 56
   \   000073   66           DB 102
   \   000074   24           DB 36
   \   000075   7C           DB 124
   \   000076   04           DB 4
   \   000077   CD           DB 205
   \   000078   13           DB 19
   \   000079   72           DB 114
   \   00007A   3C           DB 60
   \   00007B   8A           DB 138
   \   00007C   46           DB 70
   \   00007D   10           DB 16
   \   00007E   98           DB 152
   \   00007F   F7           DB 247
   \   000080   66           DB 102
   \   000081   16           DB 22
   \   000082   03           DB 3
   \   000083   46           DB 70
   \   000084   1C           DB 28
   \   000085   13           DB 19
   \   000086   56           DB 86
   \   000087   1E           DB 30
   \   000088   03           DB 3
   \   000089   46           DB 70
   \   00008A   0E           DB 14
   \   00008B   13           DB 19
   \   00008C   D1           DB 209
   \   00008D   50           DB 80
   \   00008E   52           DB 82
   \   00008F   89           DB 137
   \   000090   46           DB 70
   \   000091   FC           DB 252
   \   000092   89           DB 137
   \   000093   56           DB 86
   \   000094   FE           DB 254
   \   000095   B8           DB 184
   \   000096   20           DB 32
   \   000097   00           DB 0
   \   000098   8B           DB 139
   \   000099   76           DB 118
   \   00009A   11           DB 17
   \   00009B   F7           DB 247
   \   00009C   E6           DB 230
   \   00009D   8B           DB 139
   \   00009E   5E           DB 94
   \   00009F   0B           DB 11
   \   0000A0   03           DB 3
   \   0000A1   C3           DB 195
   \   0000A2   48           DB 72
   \   0000A3   F7           DB 247
   \   0000A4   F3           DB 243
   \   0000A5   01           DB 1
   \   0000A6   46           DB 70
   \   0000A7   FC           DB 252
   \   0000A8   11           DB 17
   \   0000A9   4E           DB 78
   \   0000AA   FE           DB 254
   \   0000AB   5A           DB 90
   \   0000AC   58           DB 88
   \   0000AD   BB           DB 187
   \   0000AE   00           DB 0
   \   0000AF   07           DB 7
   \   0000B0   8B           DB 139
   \   0000B1   FB           DB 251
   \   0000B2   B1           DB 177
   \   0000B3   01           DB 1
   \   0000B4   E8           DB 232
   \   0000B5   94           DB 148
   \   0000B6   00           DB 0
   \   0000B7   72           DB 114
   \   0000B8   47           DB 71
   \   0000B9   38           DB 56
   \   0000BA   2D           DB 45
   \   0000BB   74           DB 116
   \   0000BC   19           DB 25
   \   0000BD   B1           DB 177
   \   0000BE   0B           DB 11
   \   0000BF   56           DB 86
   \   0000C0   8B           DB 139
   \   0000C1   76           DB 118
   \   0000C2   3E           DB 62
   \   0000C3   F3           DB 243
   \   0000C4   A6           DB 166
   \   0000C5   5E           DB 94
   \   0000C6   74           DB 116
   \   0000C7   4A           DB 74
   \   0000C8   4E           DB 78
   \   0000C9   74           DB 116
   \   0000CA   0B           DB 11
   \   0000CB   03           DB 3
   \   0000CC   F9           DB 249
   \   0000CD   83           DB 131
   \   0000CE   C7           DB 199
   \   0000CF   15           DB 21
   \   0000D0   3B           DB 59
   \   0000D1   FB           DB 251
   \   0000D2   72           DB 114
   \   0000D3   E5           DB 229
   \   0000D4   EB           DB 235
   \   0000D5   D7           DB 215
   \   0000D6   2B           DB 43
   \   0000D7   C9           DB 201
   \   0000D8   B8           DB 184
   \   0000D9   D8           DB 216
   \   0000DA   7D           DB 125
   \   0000DB   87           DB 135
   \   0000DC   46           DB 70
   \   0000DD   3E           DB 62
   \   0000DE   3C           DB 60
   \   0000DF   D8           DB 216
   \   0000E0   75           DB 117
   \   0000E1   99           DB 153
   \   0000E2   BE           DB 190
   \   0000E3   80           DB 128
   \   0000E4   7D           DB 125
   \   0000E5   AC           DB 172
   \   0000E6   98           DB 152
   \   0000E7   03           DB 3
   \   0000E8   F0           DB 240
   \   0000E9   AC           DB 172
   \   0000EA   84           DB 132
   \   0000EB   C0           DB 192
   \   0000EC   74           DB 116
   \   0000ED   17           DB 23
   \   0000EE   3C           DB 60
   \   0000EF   FF           DB 255
   \   0000F0   74           DB 116
   \   0000F1   09           DB 9
   \   0000F2   B4           DB 180
   \   0000F3   0E           DB 14
   \   0000F4   BB           DB 187
   \   0000F5   07           DB 7
   \   0000F6   00           DB 0
   \   0000F7   CD           DB 205
   \   0000F8   10           DB 16
   \   0000F9   EB           DB 235
   \   0000FA   EE           DB 238
   \   0000FB   BE           DB 190
   \   0000FC   83           DB 131
   \   0000FD   7D           DB 125
   \   0000FE   EB           DB 235
   \   0000FF   E5           DB 229
   \   000100   BE           DB 190
   \   000101   81           DB 129
   \   000102   7D           DB 125
   \   000103   EB           DB 235
   \   000104   E0           DB 224
   \   000105   33           DB 51
   \   000106   C0           DB 192
   \   000107   CD           DB 205
   \   000108   16           DB 22
   \   000109   5E           DB 94
   \   00010A   1F           DB 31
   \   00010B   8F           DB 143
   \   00010C   04           DB 4
   \   00010D   8F           DB 143
   \   00010E   44           DB 68
   \   00010F   02           DB 2
   \   000110   CD           DB 205
   \   000111   19           DB 25
   \   000112   BE           DB 190
   \   000113   82           DB 130
   \   000114   7D           DB 125
   \   000115   8B           DB 139
   \   000116   7D           DB 125
   \   000117   0F           DB 15
   \   000118   83           DB 131
   \   000119   FF           DB 255
   \   00011A   02           DB 2
   \   00011B   72           DB 114
   \   00011C   C8           DB 200
   \   00011D   8B           DB 139
   \   00011E   C7           DB 199
   \   00011F   48           DB 72
   \   000120   48           DB 72
   \   000121   8A           DB 138
   \   000122   4E           DB 78
   \   000123   0D           DB 13
   \   000124   F7           DB 247
   \   000125   E1           DB 225
   \   000126   03           DB 3
   \   000127   46           DB 70
   \   000128   FC           DB 252
   \   000129   13           DB 19
   \   00012A   56           DB 86
   \   00012B   FE           DB 254
   \   00012C   BB           DB 187
   \   00012D   00           DB 0
   \   00012E   07           DB 7
   \   00012F   53           DB 83
   \   000130   B1           DB 177
   \   000131   04           DB 4
   \   000132   E8           DB 232
   \   000133   16           DB 22
   \   000134   00           DB 0
   \   000135   5B           DB 91
   \   000136   72           DB 114
   \   000137   C8           DB 200
   \   000138   81           DB 129
   \   000139   3F           DB 63
   \   00013A   4D           DB 77
   \   00013B   5A           DB 90
   \   00013C   75           DB 117
   \   00013D   A7           DB 167
   \   00013E   81           DB 129
   \   00013F   BF           DB 191
   \   000140   00           DB 0
   \   000141   02           DB 2
   \   000142   42           DB 66
   \   000143   4A           DB 74
   \   000144   75           DB 117
   \   000145   9F           DB 159
   \   000146   EA           DB 234
   \   000147   00           DB 0
   \   000148   02           DB 2
   \   000149   70           DB 112
   \   00014A   00           DB 0
   \   00014B   50           DB 80
   \   00014C   52           DB 82
   \   00014D   51           DB 81
   \   00014E   91           DB 145
   \   00014F   92           DB 146
   \   000150   33           DB 51
   \   000151   D2           DB 210
   \   000152   F7           DB 247
   \   000153   76           DB 118
   \   000154   18           DB 24
   \   000155   91           DB 145
   \   000156   F7           DB 247
   \   000157   76           DB 118
   \   000158   18           DB 24
   \   000159   42           DB 66
   \   00015A   87           DB 135
   \   00015B   CA           DB 202
   \   00015C   F7           DB 247
   \   00015D   76           DB 118
   \   00015E   1A           DB 26
   \   00015F   8A           DB 138
   \   000160   F2           DB 242
   \   000161   8A           DB 138
   \   000162   56           DB 86
   \   000163   24           DB 36
   \   000164   8A           DB 138
   \   000165   E8           DB 232
   \   000166   D0           DB 208
   \   000167   CC           DB 204
   \   000168   D0           DB 208
   \   000169   CC           DB 204
   \   00016A   0A           DB 10
   \   00016B   CC           DB 204
   \   00016C   B8           DB 184
   \   00016D   01           DB 1
   \   00016E   02           DB 2
   \   00016F   CD           DB 205
   \   000170   13           DB 19
   \   000171   59           DB 89
   \   000172   5A           DB 90
   \   000173   58           DB 88
   \   000174   72           DB 114
   \   000175   09           DB 9
   \   000176   40           DB 64
   \   000177   75           DB 117
   \   000178   01           DB 1
   \   000179   42           DB 66
   \   00017A   03           DB 3
   \   00017B   5E           DB 94
   \   00017C   0B           DB 11
   \   00017D   E2           DB 226
   \   00017E   CC           DB 204
   \   00017F   C3           DB 195
   \   000180   03           DB 3
   \   000181   18           DB 24
   \   000182   01           DB 1
   \   000183   27           DB 39
   \   000184   0D           DB 13
   \   000185   0A           DB 10
   \   000186   49           DB 73
   \   000187   6E           DB 110
   \   000188   76           DB 118
   \   000189   61           DB 97
   \   00018A   6C           DB 108
   \   00018B   69           DB 105
   \   00018C   64           DB 100
   \   00018D   20           DB 32
   \   00018E   73           DB 115
   \   00018F   79           DB 121
   \   000190   73           DB 115
   \   000191   74           DB 116
   \   000192   65           DB 101
   \   000193   6D           DB 109
   \   000194   20           DB 32
   \   000195   64           DB 100
   \   000196   69           DB 105
   \   000197   73           DB 115
   \   000198   6B           DB 107
   \   000199   FF           DB 255
   \   00019A   0D           DB 13
   \   00019B   0A           DB 10
   \   00019C   44           DB 68
   \   00019D   69           DB 105
   \   00019E   73           DB 115
   \   00019F   6B           DB 107
   \   0001A0   20           DB 32
   \   0001A1   49           DB 73
   \   0001A2   2F           DB 47
   \   0001A3   4F           DB 79
   \   0001A4   20           DB 32
   \   0001A5   65           DB 101
   \   0001A6   72           DB 114
   \   0001A7   72           DB 114
   \   0001A8   6F           DB 111
   \   0001A9   72           DB 114
   \   0001AA   FF           DB 255
   \   0001AB   0D           DB 13
   \   0001AC   0A           DB 10
   \   0001AD   52           DB 82
   \   0001AE   65           DB 101
   \   0001AF   70           DB 112
   \   0001B0   6C           DB 108
   \   0001B1   61           DB 97
   \   0001B2   63           DB 99
   \   0001B3   65           DB 101
   \   0001B4   20           DB 32
   \   0001B5   74           DB 116
   \   0001B6   68           DB 104
   \   0001B7   65           DB 101
   \   0001B8   20           DB 32
   \   0001B9   64           DB 100
   \   0001BA   69           DB 105
   \   0001BB   73           DB 115
   \   0001BC   6B           DB 107
   \   0001BD   2C           DB 44
   \   0001BE   20           DB 32
   \   0001BF   61           DB 97
   \   0001C0   6E           DB 110
   \   0001C1   64           DB 100
   \   0001C2   20           DB 32
   \   0001C3   74           DB 116
   \   0001C4   68           DB 104
   \   0001C5   65           DB 101
   \   0001C6   6E           DB 110
   \   0001C7   20           DB 32
   \   0001C8   70           DB 112
   \   0001C9   72           DB 114
   \   0001CA   65           DB 101
   \   0001CB   73           DB 115
   \   0001CC   73           DB 115
   \   0001CD   20           DB 32
   \   0001CE   61           DB 97
   \   0001CF   6E           DB 110
   \   0001D0   79           DB 121
   \   0001D1   20           DB 32
   \   0001D2   6B           DB 107
   \   0001D3   65           DB 101
   \   0001D4   79           DB 121
   \   0001D5   0D           DB 13
   \   0001D6   0A           DB 10
   \   0001D7   00           DB 0
   \   0001D8   49           DB 73
   \   0001D9   4F           DB 79
   \   0001DA   20           DB 32
   \   0001DB   20           DB 32
   \   0001DC   20           DB 32
   \   0001DD   20           DB 32
   \   0001DE   20           DB 32
   \   0001DF   20           DB 32
   \   0001E0   53           DB 83
   \   0001E1   59           DB 89
   \   0001E2   53           DB 83
   \   0001E3   4D           DB 77
   \   0001E4   53           DB 83
   \   0001E5   44           DB 68
   \   0001E6   4F           DB 79
   \   0001E7   53           DB 83
   \   0001E8   20           DB 32
   \   0001E9   20           DB 32
   \   0001EA   20           DB 32
   \   0001EB   53           DB 83
   \   0001EC   59           DB 89
   \   0001ED   53           DB 83
   \   0001EE   80           DB 128
   \   0001EF   01           DB 1
   \   0001F0   00           DB 0
   \   0001F1   57           DB 87
   \   0001F2   49           DB 73
   \   0001F3   4E           DB 78
   \   0001F4   42           DB 66
   \   0001F5   4F           DB 79
   \   0001F6   4F           DB 79
   \   0001F7   54           DB 84
   \   0001F8   20           DB 32
   \   0001F9   53           DB 83
   \   0001FA   59           DB 89
   \   0001FB   53           DB 83
   \   0001FC   00           DB 0
   \   0001FD   00           DB 0
   \   0001FE   55           DB 85
   \   0001FF   AA           DB 170
     97          {
     98          #if 1
     99           0xeb, 0x3e, 0x90,          //跳转指令，不能改为0，否则提示未格式化
    100           'M','S','D','O','S','5','.','0', //文件系统及版本信息"MSDOS5.0"
    101           0x00, 0x02,                //每扇区字节数，为512字节
    102           0x20,                      //每簇扇区数，为32扇区
    103           0x01, 0x00,                //保留扇区数，为1
    104           0x02,                      //该分区的FAT份数，为2
    105           0x00, 0x02,                //根目录项数，为512项
    106           0x00, 0x00,                //小扇区数，这里不用，为0
    107           0xF8,                      //媒体描述符，0xF8表示硬盘
    108           0x20, 0x00,                //每FAT扇区数，为32个
    109           0x20, 0x00,                //每道扇区数，为32
    110           0x40, 0x00,                //磁头数为64
    111           0x00, 0x00, 0x00, 0x00,    //隐藏扇区数这里没有隐藏扇区，为0
    112           0x00, 0x00, 0x04, 0x00,    //大扇区数，扇区的总数，128M为0x40000
    113           0x80,                      //磁盘驱动器参数，80表示硬盘
    114           0x00,                      //保留
    115           0x29,                      //扩展引导标记，0x29表示接下来的三个域可用 
    116           0x88, 0x09, 0x71, 0x20,          //标卷序列号
    117           
    118           //磁盘标卷：圈圈的假U盘
    119           //0xC8, 0xA6, 0xC8, 0xA6, 0xB5, 0xC4, 0xBC, 0xD9,
    120           //0x55, 0xC5, 0xCC,
    121          // '设','备','升','级','U','盘',
    122          0xC9,0XE8,0XB1,0XB8,0XC9,0XFD,0XBC,0XB6,0X55,0XC5,0XCC,
    123          //0X53,0X48,0X41,0X4E,0X4E,0X59,0X00,0X00,0X00,0X00,0X00,
    124           
    125           //文件系统类型信息，为字符串"FAT16   "
    126           'F', 'A', 'T', '1', '6', 0x20,0x20, 0x20, 
    127           
    128           //以下为引导代码，直接从其它U盘复制而来
    129           0xf1, 0x7d,
    130           0xfa, 0x33, 0xc9, 0x8e,  0xd1, 0xbc, 0xfc, 0x7b,  0x16, 0x07, 0xbd, 0x78,  0x00, 0xc5, 0x76, 0x00,
    131           0x1e, 0x56, 0x16, 0x55,  0xbf, 0x22, 0x05, 0x89,  0x7e, 0x00, 0x89, 0x4e,  0x02, 0xb1, 0x0b, 0xfc,
    132           0xf3, 0xa4, 0x06, 0x1f,  0xbd, 0x00, 0x7c, 0xc6,  0x45, 0xfe, 0x0f, 0x8b,  0x46, 0x18, 0x88, 0x45,
    133           0xf9, 0xfb, 0x38, 0x66,  0x24, 0x7c, 0x04, 0xcd,  0x13, 0x72, 0x3c, 0x8a,  0x46, 0x10, 0x98, 0xf7,
    134           0x66, 0x16, 0x03, 0x46,  0x1c, 0x13, 0x56, 0x1e,  0x03, 0x46, 0x0e, 0x13,  0xd1, 0x50, 0x52, 0x89,
    135           0x46, 0xfc, 0x89, 0x56,  0xfe, 0xb8, 0x20, 0x00,  0x8b, 0x76, 0x11, 0xf7,  0xe6, 0x8b, 0x5e, 0x0b,
    136           0x03, 0xc3, 0x48, 0xf7,  0xf3, 0x01, 0x46, 0xfc,  0x11, 0x4e, 0xfe, 0x5a,  0x58, 0xbb, 0x00, 0x07,
    137           0x8b, 0xfb, 0xb1, 0x01,  0xe8, 0x94, 0x00, 0x72,  0x47, 0x38, 0x2d, 0x74,  0x19, 0xb1, 0x0b, 0x56,
    138           0x8b, 0x76, 0x3e, 0xf3,  0xa6, 0x5e, 0x74, 0x4a,  0x4e, 0x74, 0x0b, 0x03,  0xf9, 0x83, 0xc7, 0x15,
    139           0x3b, 0xfb, 0x72, 0xe5,  0xeb, 0xd7, 0x2b, 0xc9,  0xb8, 0xd8, 0x7d, 0x87,  0x46, 0x3e, 0x3c, 0xd8,
    140           0x75, 0x99, 0xbe, 0x80,  0x7d, 0xac, 0x98, 0x03,  0xf0, 0xac, 0x84, 0xc0,  0x74, 0x17, 0x3c, 0xff,
    141           0x74, 0x09, 0xb4, 0x0e,  0xbb, 0x07, 0x00, 0xcd,  0x10, 0xeb, 0xee, 0xbe,  0x83, 0x7d, 0xeb, 0xe5,
    142           0xbe, 0x81, 0x7d, 0xeb,  0xe0, 0x33, 0xc0, 0xcd,  0x16, 0x5e, 0x1f, 0x8f,  0x04, 0x8f, 0x44, 0x02,
    143           0xcd, 0x19, 0xbe, 0x82,  0x7d, 0x8b, 0x7d, 0x0f,  0x83, 0xff, 0x02, 0x72,  0xc8, 0x8b, 0xc7, 0x48,
    144           0x48, 0x8a, 0x4e, 0x0d,  0xf7, 0xe1, 0x03, 0x46,  0xfc, 0x13, 0x56, 0xfe,  0xbb, 0x00, 0x07, 0x53,
    145           0xb1, 0x04, 0xe8, 0x16,  0x00, 0x5b, 0x72, 0xc8,  0x81, 0x3f, 0x4d, 0x5a,  0x75, 0xa7, 0x81, 0xbf,
    146           0x00, 0x02, 0x42, 0x4a,  0x75, 0x9f, 0xea, 0x00,  0x02, 0x70, 0x00, 0x50,  0x52, 0x51, 0x91, 0x92,
    147           0x33, 0xd2, 0xf7, 0x76,  0x18, 0x91, 0xf7, 0x76,  0x18, 0x42, 0x87, 0xca,  0xf7, 0x76, 0x1a, 0x8a,
    148           0xf2, 0x8a, 0x56, 0x24,  0x8a, 0xe8, 0xd0, 0xcc,  0xd0, 0xcc, 0x0a, 0xcc,  0xb8, 0x01, 0x02, 0xcd,
    149           0x13, 0x59, 0x5a, 0x58,  0x72, 0x09, 0x40, 0x75,  0x01, 0x42, 0x03, 0x5e,  0x0b, 0xe2, 0xcc, 0xc3,
    150           0x03, 0x18, 0x01, 0x27,  0x0d, 0x0a, 0x49, 0x6e,  0x76, 0x61, 0x6c, 0x69,  0x64, 0x20, 0x73, 0x79,
    151           0x73, 0x74, 0x65, 0x6d,  0x20, 0x64, 0x69, 0x73,  0x6b, 0xff, 0x0d, 0x0a,  0x44, 0x69, 0x73, 0x6b,
    152           0x20, 0x49, 0x2f, 0x4f,  0x20, 0x65, 0x72, 0x72,  0x6f, 0x72, 0xff, 0x0d,  0x0a, 0x52, 0x65, 0x70,
    153           0x6c, 0x61, 0x63, 0x65,  0x20, 0x74, 0x68, 0x65,  0x20, 0x64, 0x69, 0x73,  0x6b, 0x2c, 0x20, 0x61,
    154           0x6e, 0x64, 0x20, 0x74,  0x68, 0x65, 0x6e, 0x20,  0x70, 0x72, 0x65, 0x73,  0x73, 0x20, 0x61, 0x6e,
    155           0x79, 0x20, 0x6b, 0x65,  0x79, 0x0d, 0x0a, 0x00,  0x49, 0x4f, 0x20, 0x20,  0x20, 0x20, 0x20, 0x20,
    156           0x53, 0x59, 0x53, 0x4d,  0x53, 0x44, 0x4f, 0x53,  0x20, 0x20, 0x20, 0x53,  0x59, 0x53, 0x80, 0x01,
    157           0x00, 0x57, 0x49, 0x4e,  0x42, 0x4f, 0x4f, 0x54,  0x20, 0x53, 0x59, 0x53,  0x00, 0x00, 0x55, 0xaa,
    158           #else
    159          0xeb,0x58,0x90,0x4d,0x53,0x44,0x4f,0x53,0x35,0x2e,0x30,0x00,0x02,0x08,0xce,0x09,0x02,0x00,0x00,0x00,0x00,0xf8,0x00,0x00,0x3f,0x00,0xff,0x00,0x00,0x00,0x00,0x00,
    160          0x00,0xe0,0xec,0x00,0x19,0x3b,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x01,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    161          0x80,0x00,0x29,0x3e,0xde,0x13,0x12,0x4e,0x4f,0x20,0x4e,0x41,0x4d,0x45,0x20,0x20,0x20,0x20,0x46,0x41,0x54,0x33,0x32,0x20,0x20,0x20,0x33,0xc9,0x8e,0xd1,0xbc,0xf4,
    162          0x7b,0x8e,0xc1,0x8e,0xd9,0xbd,0x00,0x7c,0x88,0x4e,0x02,0x8a,0x56,0x40,0xb4,0x41,0xbb,0xaa,0x55,0xcd,0x13,0x72,0x10,0x81,0xfb,0x55,0xaa,0x75,0x0a,0xf6,0xc1,0x01,
    163          0x74,0x05,0xfe,0x46,0x02,0xeb,0x2d,0x8a,0x56,0x40,0xb4,0x08,0xcd,0x13,0x73,0x05,0xb9,0xff,0xff,0x8a,0xf1,0x66,0x0f,0xb6,0xc6,0x40,0x66,0x0f,0xb6,0xd1,0x80,0xe2,
    164          0x3f,0xf7,0xe2,0x86,0xcd,0xc0,0xed,0x06,0x41,0x66,0x0f,0xb7,0xc9,0x66,0xf7,0xe1,0x66,0x89,0x46,0xf8,0x83,0x7e,0x16,0x00,0x75,0x38,0x83,0x7e,0x2a,0x00,0x77,0x32,
    165          0x66,0x8b,0x46,0x1c,0x66,0x83,0xc0,0x0c,0xbb,0x00,0x80,0xb9,0x01,0x00,0xe8,0x2b,0x00,0xe9,0x2c,0x03,0xa0,0xfa,0x7d,0xb4,0x7d,0x8b,0xf0,0xac,0x84,0xc0,0x74,0x17,
    166          0x3c,0xff,0x74,0x09,0xb4,0x0e,0xbb,0x07,0x00,0xcd,0x10,0xeb,0xee,0xa0,0xfb,0x7d,0xeb,0xe5,0xa0,0xf9,0x7d,0xeb,0xe0,0x98,0xcd,0x16,0xcd,0x19,0x66,0x60,0x80,0x7e,
    167          0x02,0x00,0x0f,0x84,0x20,0x00,0x66,0x6a,0x00,0x66,0x50,0x06,0x53,0x66,0x68,0x10,0x00,0x01,0x00,0xb4,0x42,0x8a,0x56,0x40,0x8b,0xf4,0xcd,0x13,0x66,0x58,0x66,0x58,
    168          0x66,0x58,0x66,0x58,0xeb,0x33,0x66,0x3b,0x46,0xf8,0x72,0x03,0xf9,0xeb,0x2a,0x66,0x33,0xd2,0x66,0x0f,0xb7,0x4e,0x18,0x66,0xf7,0xf1,0xfe,0xc2,0x8a,0xca,0x66,0x8b,
    169          0xd0,0x66,0xc1,0xea,0x10,0xf7,0x76,0x1a,0x86,0xd6,0x8a,0x56,0x40,0x8a,0xe8,0xc0,0xe4,0x06,0x0a,0xcc,0xb8,0x01,0x02,0xcd,0x13,0x66,0x61,0x0f,0x82,0x75,0xff,0x81,
    170          0xc3,0x00,0x02,0x66,0x40,0x49,0x75,0x94,0xc3,0x42,0x4f,0x4f,0x54,0x4d,0x47,0x52,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    171          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    172          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0x0a,0x52,0x65,0x6d,0x6f,0x76,0x65,0x20,0x64,0x69,0x73,0x6b,0x73,0x20,0x6f,0x72,0x20,0x6f,0x74,
    173          0x68,0x65,0x72,0x20,0x6d,0x65,0x64,0x69,0x61,0x2e,0xff,0x0d,0x0a,0x44,0x69,0x73,0x6b,0x20,0x65,0x72,0x72,0x6f,0x72,0xff,0x0d,0x0a,0x50,0x72,0x65,0x73,0x73,0x20,
    174          0x61,0x6e,0x79,0x20,0x6b,0x65,0x79,0x20,0x74,0x6f,0x20,0x72,0x65,0x73,0x74,0x61,0x72,0x74,0x0d,0x0a,0x00,0x00,0x00,0x00,0x00,0xac,0xcb,0xd8,0x00,0x00,0x55,0xaa,
    175           #endif
    176          };
    177          
    178          //模拟的文件分配表
    179          //其中项0为0xFFF8，项1为0xFFFF，表示已经使用。
    180          //项2为0xFFFF，表示文件结束。其余项为0，表示未使用

   \                                 In  segment XDATA_ROM_C, align 1
    181          const uint8 Fat[64]=
   \                     Fat:
   \   000000   F8           DB 248
   \   000001   FF           DB 255
   \   000002   FF           DB 255
   \   000003   FF           DB 255
   \   000004   FF           DB 255
   \   000005   FF           DB 255
   \   000006   00           DB 0
   \   000007   00           DB 0
   \   000008   00           DB 0
   \   000009   00           DB 0
   \   00000A   00           DB 0
   \   00000B   00           DB 0
   \   00000C   00           DB 0
   \   00000D   00           DB 0
   \   00000E   00           DB 0
   \   00000F   00           DB 0
   \   000010   00           DB 0
   \   000011   00           DB 0
   \   000012   00           DB 0
   \   000013   00           DB 0
   \   000014   00           DB 0
   \   000015   00           DB 0
   \   000016   00           DB 0
   \   000017   00           DB 0
   \   000018   00           DB 0
   \   000019   00           DB 0
   \   00001A   00           DB 0
   \   00001B   00           DB 0
   \   00001C   00           DB 0
   \   00001D   00           DB 0
   \   00001E   00           DB 0
   \   00001F   00           DB 0
   \   000020   00           DB 0
   \   000021   00           DB 0
   \   000022   00           DB 0
   \   000023   00           DB 0
   \   000024   00           DB 0
   \   000025   00           DB 0
   \   000026   00           DB 0
   \   000027   00           DB 0
   \   000028   00           DB 0
   \   000029   00           DB 0
   \   00002A   00           DB 0
   \   00002B   00           DB 0
   \   00002C   00           DB 0
   \   00002D   00           DB 0
   \   00002E   00           DB 0
   \   00002F   00           DB 0
   \   000030   00           DB 0
   \   000031   00           DB 0
   \   000032   00           DB 0
   \   000033   00           DB 0
   \   000034   00           DB 0
   \   000035   00           DB 0
   \   000036   00           DB 0
   \   000037   00           DB 0
   \   000038   00           DB 0
   \   000039   00           DB 0
   \   00003A   00           DB 0
   \   00003B   00           DB 0
   \   00003C   00           DB 0
   \   00003D   00           DB 0
   \   00003E   00           DB 0
   \   00003F   00           DB 0
    182          {
    183           0xF8, 0xFF, 0xFF, 0xFF,  0xFF, 0xFF, 0x00, 0x00, 
    184           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    185           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    186           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    187           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    188           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    189           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    190           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00
    191          };
    192          
    193          //64字节的0，填充0用。

   \                                 In  segment XDATA_ROM_C, align 1
    194          const uint8 Zeros[64]=
   \                     Zeros:
   \   000000   00           DB 0
   \   000001   00           DB 0
   \   000002   00           DB 0
   \   000003   00           DB 0
   \   000004   00           DB 0
   \   000005   00           DB 0
   \   000006   00           DB 0
   \   000007   00           DB 0
   \   000008   00           DB 0
   \   000009   00           DB 0
   \   00000A   00           DB 0
   \   00000B   00           DB 0
   \   00000C   00           DB 0
   \   00000D   00           DB 0
   \   00000E   00           DB 0
   \   00000F   00           DB 0
   \   000010   00           DB 0
   \   000011   00           DB 0
   \   000012   00           DB 0
   \   000013   00           DB 0
   \   000014   00           DB 0
   \   000015   00           DB 0
   \   000016   00           DB 0
   \   000017   00           DB 0
   \   000018   00           DB 0
   \   000019   00           DB 0
   \   00001A   00           DB 0
   \   00001B   00           DB 0
   \   00001C   00           DB 0
   \   00001D   00           DB 0
   \   00001E   00           DB 0
   \   00001F   00           DB 0
   \   000020   00           DB 0
   \   000021   00           DB 0
   \   000022   00           DB 0
   \   000023   00           DB 0
   \   000024   00           DB 0
   \   000025   00           DB 0
   \   000026   00           DB 0
   \   000027   00           DB 0
   \   000028   00           DB 0
   \   000029   00           DB 0
   \   00002A   00           DB 0
   \   00002B   00           DB 0
   \   00002C   00           DB 0
   \   00002D   00           DB 0
   \   00002E   00           DB 0
   \   00002F   00           DB 0
   \   000030   00           DB 0
   \   000031   00           DB 0
   \   000032   00           DB 0
   \   000033   00           DB 0
   \   000034   00           DB 0
   \   000035   00           DB 0
   \   000036   00           DB 0
   \   000037   00           DB 0
   \   000038   00           DB 0
   \   000039   00           DB 0
   \   00003A   00           DB 0
   \   00003B   00           DB 0
   \   00003C   00           DB 0
   \   00003D   00           DB 0
   \   00003E   00           DB 0
   \   00003F   00           DB 0
    195          {
    196           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    197           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    198           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    199           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    200           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    201           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    202           0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
    203           0x00, 0x00 ,0x00, 0x00,  0x00, 0x00, 0x00, 0x00
    204          };
    205          
    206          #ifdef INCLUDE_TEST_FILE
    207          //测试文件的数据

   \                                 In  segment XDATA_ROM_C, align 1
    208          const uint8 TestFileData[]=
   \                     TestFileData:
   \   000000   B8D0D0BB     DB 0B8H, 0D0H, 0D0H, 0BBH, 0C4H, 0FAH, 0CAH, 0B9H
   \            C4FACAB9
   \   000008   D3C3B1BE     DB 0D3H, 0C3H, 0B1H, 0BEH, 0B9H, 0ABH, 0CBH, 0BEH
   \            B9ABCBBE
   \   000010   B2FAC6B7     DB 0B2H, 0FAH, 0C6H, 0B7H, 0A3H, 0ACH, 0CEH, 0D2H
   \            A3ACCED2
   \   000018   C3C7BDAB     DB 0C3H, 0C7H, 0BDH, 0ABH, 0BDH, 0DFH, 0B3H, 0CFH
   \            BDDFB3CF
   \   000020   CEAAC4FA     DB 0CEH, 0AAH, 0C4H, 0FAH, 0B7H, 0FEH, 0CEH, 0F1H
   \            B7FECEF1
   \   000028   0D0AB1BE     DB 0DH, 0AH, 0B1H, 0BEH, 0C5H, 0CCH, 0D6H, 0BBH
   \            C5CCD6BB
   \   000030   C4DCD3C3     DB 0C4H, 0DCH, 0D3H, 0C3H, 0D3H, 0DAH, 0C9H, 0FDH
   \            D3DAC9FD
   \   000038   BCB6B9CC     DB 0BCH, 0B6H, 0B9H, 0CCH, 0BCH, 0FEH, 0B3H, 0CCH
   \            BCFEB3CC
   \   000040   D0F2A3AC     DB 0D0H, 0F2H, 0A3H, 0ACH, 0B2H, 0BBH, 0C4H, 0DCH
   \            B2BBC4DC
   \   000048   D3C3D3DA     DB 0D3H, 0C3H, 0D3H, 0DAH, 0CEH, 0C4H, 0BCH, 0FEH
   \            CEC4BCFE
   \   000050   B4E6B4A2     DB 0B4H, 0E6H, 0B4H, 0A2H, 0A3H, 0ACH, 0DH, 0AH
   \            A3AC0D0A
   \   000058   B9CCBCFE     DB 0B9H, 0CCH, 0BCH, 0FEH, 0B3H, 0CCH, 0D0H, 0F2H
   \            B3CCD0F2
   \   000060   C7EBB5BD     DB 0C7H, 0EBH, 0B5H, 0BDH, 0D6H, 0B8H, 0B6H, 0A8H
   \            D6B8B6A8
   \   000068   B9D9CDF8     DB 0B9H, 0D9H, 0CDH, 0F8H, 0CFH, 0C2H, 0D4H, 0D8H
   \            CFC2D4D8
   \   000070   0D0AB8F8     DB 0DH, 0AH, 0B8H, 0F8H, 0B1H, 0BEH, 0C9H, 0E8H
   \            B1BEC9E8
   \   000078   B1B8C9FD     DB 0B1H, 0B8H, 0C9H, 0FDH, 0BCH, 0B6H, 0B3H, 0CCH
   \            BCB6B3CC
   \   000080   D0F2CAB1     DB 0D0H, 0F2H, 0CAH, 0B1H, 0A3H, 0ACH, 0B2H, 0BBH
   \            A3ACB2BB
   \   000088   D2AAC1AC     DB 0D2H, 0AAH, 0C1H, 0ACH, 0BDH, 0D3H, 0C9H, 0C1H
   \            BDD3C9C1
   \   000090   B9E2B5C6     DB 0B9H, 0E2H, 0B5H, 0C6H, 0A3H, 0ACH, 0B8H, 0F8H
   \            A3ACB8F8
   \   000098   D6F7B5C6     DB 0D6H, 0F7H, 0B5H, 0C6H, 0C9H, 0FDH, 0BCH, 0B6H
   \            C9FDBCB6
   \   0000A0   CAB1A3AC     DB 0CAH, 0B1H, 0A3H, 0ACH, 0C7H, 0EBH, 0C1H, 0ACH
   \            C7EBC1AC
   \   0000A8   C9CFC9C1     DB 0C9H, 0CFH, 0C9H, 0C1H, 0B9H, 0E2H, 0B5H, 0C6H
   \            B9E2B5C6
   \   0000B0   A3AC0D0A     DB 0A3H, 0ACH, 0DH, 0AH, 0C9H, 0FDH, 0BCH, 0B6H
   \            C9FDBCB6
   \   0000B8   B9CCBCFE     DB 0B9H, 0CCH, 0BCH, 0FEH, 0B3H, 0CCH, 0D0H, 0F2H
   \            B3CCD0F2
   \   0000C0   CAB1A3AC     DB 0CAH, 0B1H, 0A3H, 0ACH, 0D6H, 0BBH, 0D0H, 0E8H
   \            D6BBD0E8
   \   0000C8   D2AABDAB     DB 0D2H, 0AAH, 0BDH, 0ABH, 0CEH, 0C4H, 0BCH, 0FEH
   \            CEC4BCFE
   \   0000D0   BDE2D1B9     DB 0BDH, 0E2H, 0D1H, 0B9H, 0A3H, 0ACH, 0C8H, 0BBH
   \            A3ACC8BB
   \   0000D8   BAF3CDCF     DB 0BAH, 0F3H, 0CDH, 0CFH, 0D7H, 0A7H, 0BDH, 0F8H
   \            D7A7BDF8
   \   0000E0   55C5CCBC     DB 55H, 0C5H, 0CCH, 0BCH, 0B4H, 0BFH, 0C9H, 0DH
   \            B4BFC90D
   \   0000E8   0A00         DB 0AH, 0
    209          {
    210          // "这是一个测试程序，用来测试文件系统是否工作正常。\r\n如果你能看到这些文字，那么说明你的电脑已经中了最\r\n无耻的电脑圈圈病毒了，请马上把所有文件删除，并格\r\n式化硬盘后，将硬盘压碎，以免你也被感染！如果你在\r\n30秒内还未开始删除文件，你的电脑将会永久报废！\r\n欢迎访问我们的USB专区: http://group.ednchina.com/93/"
    211          "感谢您使用本公司产品，我们将竭诚为您服务\r\n\
    212          本盘只能用于升级固件程序，不能用于文件存储，\r\n\
    213          固件程序请到指定官网下载\r\n\
    214          给本设备升级程序时，不要连接闪光灯，给主灯升级时，请连上闪光灯，\r\n\
    215          升级固件程序时，只需要将文件解压，然后拖拽进U盘即可\r\n"
    216          };
    217          
    218          
    219          /********** 时间格式（16Bits）为： **************
    220           Bits15~11表示小时，可以取值为0~23；
    221           Bits10~5表示分，可以取值为0~59； 
    222           Bits4~0表示秒，可以取值为0~29，每单位为2秒，即实际秒值为该值的2倍。
    223          */
    224          
    225          /********* 日期格式（16Bits）为：  *************
    226           Bits15~9表示年份，可以取值为0~127，它表示距离1980年差值，
    227                    即实际的年份为该值加上1980，最大可表示到2107年；
    228                    
    229           Bits8~5表示月份，可以取值为1~12；
    230           Bits4~0表示号数，可以取值为1~31。
    231          */
    232          
    233          //求出16位时间格式的高字节
    234          #define TIME_HB(H,M,S) (((((H)<<11))|((M)<<5)|(S))>>8)
    235          //求出16位时间格式的低字节
    236          #define TIME_LB(H,M,S) ((((H)<<11))|((M)<<5)|(S))
    237          
    238          //求出16位日期格式的高字节
    239          #define DATE_HB(Y,M,D) (((((Y)-1980)<<9)|((M)<<5)|(D))>>8)
    240          //求出16位日期格式的低字节
    241          #define DATE_LB(Y,M,D) ((((Y)-1980)<<9)|((M)<<5)|(D))
    242          
    243          
    244          //根目录

   \                                 In  segment XDATA_ROM_C, align 1
    245          const uint8 RootDir[64]=
   \                     RootDir:
   \   000000   53           DB 83
   \   000001   4E           DB 78
   \   000002   36           DB 54
   \   000003   30           DB 48
   \   000004   30           DB 48
   \   000005   43           DB 67
   \   000006   2D           DB 45
   \   000007   52           DB 82
   \   000008   54           DB 84
   \   000009   00           DB 0
   \   00000A   00           DB 0
   \   00000B   08           DB 8
   \   00000C   00           DB 0
   \   00000D   00           DB 0
   \   00000E   63           DB 99
   \   00000F   7B           DB 123
   \   000010   13           DB 19
   \   000011   39           DB 57
   \   000012   14           DB 20
   \   000013   39           DB 57
   \   000014   00           DB 0
   \   000015   00           DB 0
   \   000016   AF           DB 175
   \   000017   7C           DB 124
   \   000018   13           DB 19
   \   000019   39           DB 57
   \   00001A   00           DB 0
   \   00001B   00           DB 0
   \   00001C   00           DB 0
   \   00001D   00           DB 0
   \   00001E   00           DB 0
   \   00001F   00           DB 0
   \   000020   52           DB 82
   \   000021   45           DB 69
   \   000022   41           DB 65
   \   000023   44           DB 68
   \   000024   20           DB 32
   \   000025   20           DB 32
   \   000026   20           DB 32
   \   000027   20           DB 32
   \   000028   54           DB 84
   \   000029   58           DB 88
   \   00002A   54           DB 84
   \   00002B   01           DB 1
   \   00002C   00           DB 0
   \   00002D   00           DB 0
   \   00002E   1A           DB 26
   \   00002F   7E           DB 126
   \   000030   13           DB 19
   \   000031   39           DB 57
   \   000032   14           DB 20
   \   000033   39           DB 57
   \   000034   00           DB 0
   \   000035   00           DB 0
   \   000036   61           DB 97
   \   000037   7E           DB 126
   \   000038   13           DB 19
   \   000039   39           DB 57
   \   00003A   02           DB 2
   \   00003B   00           DB 0
   \   00003C   E9           DB 233
   \   00003D   00           DB 0
   \   00003E   00           DB 0
   \   00003F   00           DB 0
    246          {
    247          //磁盘标卷：圈圈的假U盘
    248           //0xC8, 0xA6, 0xC8, 0xA6, 0xB5, 0xC4, 0xBC, 0xD9, 0x55, 0xC5, 0xCC, 
    249          //0xC9,0XE8,0XB1,0XB8,0XC9,0XFD,0XBC,0XB6,0X55,0XC5,0XCC,
    250          //0X53,0X48,0X41,0X4E,0X4E,0X59,0X00,0X00,0X00,0X00,0X00,
    251          'S','N','6','0','0','C','-','R','T',0X00,0X00,//SN600C-RT
    252           0x08,                  //文件属性，表示磁盘标卷
    253           0x00,                  //保留
    254           0x00,                  //创建时间毫秒时间戳
    255           
    256           //文件创建时间，15点27分35秒
    257           TIME_LB(15,27,35), TIME_HB(15,27,35),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    258           
    259           //文件创建日期，2008年8月19日
    260           DATE_LB(2008,8,19), DATE_HB(2008,8,19),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    261           
    262           //最后访问日期，2008年8月20日
    263           DATE_LB(2008,8,20), DATE_HB(2008,8,20),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    264           
    265           0x00, 0x00,            //起始簇号高位字节，FAT12/16必须为0
    266           
    267           //最后修改时间，15点36分47秒
    268           TIME_LB(15,36,47), TIME_HB(15,36,47),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    269           
    270           //最后修改日期，2008年8月19日
    271           DATE_LB(2008,8,19), DATE_HB(2008,8,19),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    272           
    273           0x00, 0x00,            //起始簇低字
    274           0x00, 0x00, 0x00, 0x00,   //文件长度
    275           
    276          //根目录下的测试文件
    277           //文件名“TEST.TXT”
    278           'R',  'E',   'A',  'D', ' ', ' ', ' ', ' ',  'T', 'X', 'T',
    279           0x01,                  //文件属性，表示只读文件
    280           0x00,                  //保留
    281           0x00,                  //创建时间毫秒时间戳
    282           //文件创建时间，15点48分26秒
    283           TIME_LB(15,48,26), TIME_HB(15,48,26),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    284           
    285           //文件创建日期,2008年8月19日
    286           DATE_LB(2008,8,19), DATE_HB(2008,8,19),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    287           
    288           //最后访问日期
    289           DATE_LB(2008,8,20), DATE_HB(2008,8,20),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    290           
    291           0x00, 0x00,            //起始簇号高位字节，FAT12/16必须为0
    292           
    293           //最后修改时间,15点50分33秒
    294           TIME_LB(15,50,33), TIME_HB(15,50,33),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    295           
    296           //最后修改日期，2008年8月19日
    297           DATE_LB(2008,8,19), DATE_HB(2008,8,19),
                  ^
Warning[Pe069]: integer conversion resulted in truncation
    298           
    299           0x02, 0x00,            //起始簇低字，簇2。
    300           
    301           //文件长度
    302           (sizeof(TestFileData)-1),((sizeof(TestFileData)-1)>>8), 0x00, 0x00,
    303          };
    304          #endif
    305          #endif
    306          
    307          
    308          
    309          
    310          


   Segment part sizes:

     Function/Label Bytes
     -------------- -----
     Dbr             512
     Fat              64
     Zeros            64
     TestFileData    234
     RootDir          64

 
 938 bytes in segment XDATA_ROM_C
 
 938 bytes of CONST memory

Errors: none
Warnings: 10
