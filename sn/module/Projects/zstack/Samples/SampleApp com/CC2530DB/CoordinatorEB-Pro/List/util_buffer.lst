###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.4.40412/W32 for 8051         19/Jun/2016  18:16:18 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\freeman\Documents\work\SN\module\Componen #
#                          ts\hal\target\CC2530EB\util_buffer.c               #
#    Command line       =  -f "C:\Users\freeman\Documents\work\SN\module\Proj #
#                          ects\zstack\Samples\SampleApp                      #
#                          com\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg #
#                          " (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR    #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF0                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100 -DREJOIN_POLL_RATE=440)   #
#                          C:\Users\freeman\Documents\work\SN\module\Componen #
#                          ts\hal\target\CC2530EB\util_buffer.c -D ZIGBEEPRO  #
#                          -D ZTOOL_P1 -lC "C:\Users\freeman\Documents\work\S #
#                          N\module\Projects\zstack\Samples\SampleApp         #
#                          com\CC2530DB\CoordinatorEB-Pro\List\" -lA          #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\CoordinatorEB-Pro\List\"              #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\CoordinatorEB-Pro\Obj\" -e --debug    #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Users\freeman\Document #
#                          s\work\SN\module\Projects\zstack\Samples\SampleApp #
#                           com\CC2530DB\" -I "C:\Users\freeman\Documents\wor #
#                          k\SN\module\Projects\zstack\Samples\SampleApp      #
#                          com\CC2530DB\..\SOURCE\" -I                        #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I          #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MT\" -I     #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE #
#                          \" -I "C:\Users\freeman\Documents\work\SN\module\P #
#                          rojects\zstack\Samples\SampleApp                   #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\ #
#                          CC2530EB\" -I "C:\Users\freeman\Documents\work\SN\ #
#                          module\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CC #
#                          SOC\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUD #
#                          E\" -I "C:\Users\freeman\Documents\work\SN\module\ #
#                          Projects\zstack\Samples\SampleApp                  #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF\"  #
#                          -I "C:\Users\freeman\Documents\work\SN\module\Proj #
#                          ects\zstack\Samples\SampleApp                      #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ #
#                          " -I "C:\Users\freeman\Documents\work\SN\module\Pr #
#                          ojects\zstack\Samples\SampleApp                    #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" #
#                           -I "C:\Users\freeman\Documents\work\SN\module\Pro #
#                          jects\zstack\Samples\SampleApp                     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\"  #
#                          -I "C:\Users\freeman\Documents\work\SN\module\Proj #
#                          ects\zstack\Samples\SampleApp                      #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I   #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SA #
#                          DDR\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SD #
#                          ATA\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE #
#                          \" -I "C:\Users\freeman\Documents\work\SN\module\P #
#                          rojects\zstack\Samples\SampleApp                   #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LE #
#                          VEL\" -I "C:\Users\freeman\Documents\work\SN\modul #
#                          e\Projects\zstack\Samples\SampleApp                #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\srf04\" -I "C:\Users\freeman\Documents\work\SN\ #
#                          module\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\srf04\SINGLE_CHIP\" -I                          #
#                          "C:\Users\freeman\Documents\work\SN\module\Project #
#                          s\zstack\Samples\SampleApp                         #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\usb\library #
#                          \" -I "C:\Users\freeman\Documents\work\SN\module\P #
#                          rojects\zstack\Samples\SampleApp                   #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\usb\class_h #
#                          id\" -I "C:\Users\freeman\Documents\work\SN\module #
#                          \Projects\zstack\Samples\SampleApp                 #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\hal\common\ #
#                          " -Ohz --require_prototypes                        #
#    List file          =  C:\Users\freeman\Documents\work\SN\module\Projects #
#                          \zstack\Samples\SampleApp                          #
#                          com\CC2530DB\CoordinatorEB-Pro\List\util_buffer.ls #
#                          t                                                  #
#    Object file        =  C:\Users\freeman\Documents\work\SN\module\Projects #
#                          \zstack\Samples\SampleApp                          #
#                          com\CC2530DB\CoordinatorEB-Pro\Obj\util_buffer.r51 #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\freeman\Documents\work\SN\module\Components\hal\target\CC2530EB\util_buffer.c
      1          /***********************************************************************************
      2            Filename:     util_buffer.c
      3          
      4            Description:  Ringbuffer implementation.
      5          
      6          ***********************************************************************************/
      7          
      8          /***********************************************************************************
      9          * INCLUDES
     10          */
     11          #include "util_buffer.h"
     12          #include "hal_board.h"
     13          #include "hal_int.h"
     14          #include "hal_assert.h"
     15          
     16          /***********************************************************************************
     17          * GLOBAL FUNCTIONS
     18          */
     19          
     20          /***********************************************************************************
     21          * @fn      bufInit
     22          *
     23          * @brief   Initialise a ringbuffer. The buffer must be allocated by the
     24          *          application.
     25          *
     26          * @param   pBuf - pointer to the ringbuffer
     27          *
     28          * @return  none
     29          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     30          void bufInit(ringBuf_t *pBuf)
   \                     bufInit:
     31          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
     32              uint16 s;
     33          
     34              // Critical section start
     35              s = halIntLock();
   \   000009                ; Setup parameters for call to function halIntLock
   \   000009   12....       LCALL   ??halIntLock?relay
     36          
     37              pBuf->nBytes= 0;
   \   00000C   EE           MOV     A,R6
   \   00000D   2440         ADD     A,#0x40
   \   00000F   12....       LCALL   ?Subroutine2 & 0xFFFF
     38              pBuf->iHead= 0;
   \                     ??CrossCallReturnLabel_0:
   \   000012   EE           MOV     A,R6
   \   000013   2441         ADD     A,#0x41
   \   000015   12....       LCALL   ?Subroutine2 & 0xFFFF
     39              pBuf->iTail= 0;
   \                     ??CrossCallReturnLabel_1:
   \   000018   EE           MOV     A,R6
   \   000019   2442         ADD     A,#0x42
   \   00001B   12....       LCALL   ?Subroutine2 & 0xFFFF
     40          
     41              // Critical section end
     42              halIntUnlock(s);
   \                     ??CrossCallReturnLabel_2:
   \   00001E                ; Setup parameters for call to function halIntUnlock
   \   00001E   12....       LCALL   ??halIntUnlock?relay
     43          }
   \   000021   7F02         MOV     R7,#0x2
   \   000023   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E4           CLR     A
   \   000008   F0           MOVX    @DPTR,A
   \   000009   22           RET
     44          
     45          
     46          /***********************************************************************************
     47          * @fn      bufPut
     48          *
     49          * @brief   Add bytes to the buffer.
     50          *
     51          * @param   pBuf - pointer to the ringbuffer
     52          *          pData - pointer to data to be appended to the buffer
     53          *          nBytes - number of bytes
     54          *
     55          * @return  Number of bytes copied to the buffer
     56          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     57          uint8 bufPut(ringBuf_t *pBuf, const uint8 *pData, uint8 nBytes)
   \                     bufPut:
     58          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   \   00000D   89..         MOV     ?V0 + 2,R1
     59              uint8 i;
     60              uint16 s;
     61          
     62              // Critical section start
     63              s = halIntLock();
   \   00000F                ; Setup parameters for call to function halIntLock
   \   00000F   12....       LCALL   ??halIntLock?relay
     64              
     65              if (pBuf->nBytes+nBytes < BUF_SIZE) {
   \   000012   EE           MOV     A,R6
   \   000013   2440         ADD     A,#0x40
   \   000015   F8           MOV     R0,A
   \   000016   EF           MOV     A,R7
   \   000017   3400         ADDC    A,#0x0
   \   000019   F9           MOV     R1,A
   \   00001A   8882         MOV     DPL,R0
   \   00001C   8983         MOV     DPH,R1
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   85....       MOV     ?V0 + 4,?V0 + 2
   \   000022   25..         ADD     A,?V0 + 4
   \   000024   FC           MOV     R4,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   FD           MOV     R5,A
   \   000029   EC           MOV     A,R4
   \   00002A   9440         SUBB    A,#0x40
   \   00002C   ED           MOV     A,R5
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   75..00       MOV     ?V0 + 3,#0x0
   \   000036   504D         JNC     ??bufPut_0
     66          
     67                  i= 0;
   \   000038   EE           MOV     A,R6
   \   000039   2442         ADD     A,#0x42
   \   00003B   FC           MOV     R4,A
   \   00003C   EF           MOV     A,R7
   \   00003D   3400         ADDC    A,#0x0
   \   00003F   FD           MOV     R5,A
   \   000040   8034         SJMP    ??bufPut_1
     68                  while(i<nBytes) {
     69                      pBuf->pData[pBuf->iTail]= pData[i];
   \                     ??bufPut_2:
   \   000042   85....       MOV     ?V0 + 4,?V0 + 3
   \   000045   E5..         MOV     A,?V0 + 0
   \   000047   25..         ADD     A,?V0 + 4
   \   000049   F582         MOV     DPL,A
   \   00004B   E5..         MOV     A,?V0 + 1
   \   00004D   12....       LCALL   ??Subroutine4_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000050   C0E0         PUSH    A
   \   000052   8C82         MOV     DPL,R4
   \   000054   8D83         MOV     DPH,R5
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F5..         MOV     ?V0 + 4,A
   \   000059   EE           MOV     A,R6
   \   00005A   25..         ADD     A,?V0 + 4
   \   00005C   F582         MOV     DPL,A
   \   00005E   EF           MOV     A,R7
   \   00005F   3400         ADDC    A,#0x0
   \   000061   F583         MOV     DPH,A
   \   000063   D0E0         POP     A
   \   000065   F0           MOVX    @DPTR,A
     70                      pBuf->iTail++;
   \   000066   8C82         MOV     DPL,R4
   \   000068   8D83         MOV     DPH,R5
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   04           INC     A
   \   00006C   F0           MOVX    @DPTR,A
     71                      if (pBuf->iTail==BUF_SIZE)
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   6440         XRL     A,#0x40
   \   000070   7002         JNZ     ??bufPut_3
     72                          pBuf->iTail= 0;
   \   000072   E4           CLR     A
   \   000073   F0           MOVX    @DPTR,A
     73                      i++;
   \                     ??bufPut_3:
   \   000074   05..         INC     ?V0 + 3
     74                  }
   \                     ??bufPut_1:
   \   000076   E5..         MOV     A,?V0 + 3
   \   000078   C3           CLR     C
   \   000079   95..         SUBB    A,?V0 + 2
   \   00007B   40C5         JC      ??bufPut_2
     75                  pBuf->nBytes+= i;
   \   00007D   8882         MOV     DPL,R0
   \   00007F   8983         MOV     DPH,R1
   \   000081   E0           MOVX    A,@DPTR
   \   000082   25..         ADD     A,?V0 + 3
   \   000084   F0           MOVX    @DPTR,A
     76              } else {
     77                  i= 0;
     78              }
     79          
     80              // Critical section end
     81              halIntUnlock(s);
   \                     ??bufPut_0:
   \   000085                ; Setup parameters for call to function halIntUnlock
   \   000085                REQUIRE ?Subroutine0
   \   000085                ; // Fall through to label ?Subroutine0
     82          
     83              return i;
     84          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ??halIntUnlock?relay
   \   000003   A9..         MOV     R1,?V0 + 3
   \   000005                REQUIRE ??Subroutine3_0
   \   000005                ; // Fall through to label ??Subroutine3_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine3_0:
   \   000000   7F06         MOV     R7,#0x6
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET
     85          
     86          
     87          /***********************************************************************************
     88          * @fn      bufGet
     89          *
     90          * @brief   Extract bytes from the buffer.
     91          *
     92          * @param   pBuf   - pointer to the ringbuffer
     93          *          pData  - pointer to data to be extracted
     94          *          nBytes - number of bytes
     95          *
     96          * @return  Bytes actually returned
     97          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     98          uint8 bufGet(ringBuf_t *pBuf, uint8 *pData, uint8 nBytes)
   \                     bufGet:
     99          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   \   00000D   89..         MOV     ?V0 + 2,R1
    100              uint8 i;
    101              uint16 s;
    102          
    103              // Critical section start
    104              s = halIntLock();
   \   00000F                ; Setup parameters for call to function halIntLock
   \   00000F   12....       LCALL   ??halIntLock?relay
    105          
    106              i= 0;
   \   000012   75..00       MOV     ?V0 + 3,#0x0
   \   000015   EE           MOV     A,R6
   \   000016   2441         ADD     A,#0x41
   \   000018   F8           MOV     R0,A
   \   000019   EF           MOV     A,R7
   \   00001A   3400         ADDC    A,#0x0
   \   00001C   F9           MOV     R1,A
   \   00001D   EE           MOV     A,R6
   \   00001E   2440         ADD     A,#0x40
   \   000020   FC           MOV     R4,A
   \   000021   EF           MOV     A,R7
   \   000022   3400         ADDC    A,#0x0
   \   000024   FD           MOV     R5,A
   \   000025   8031         SJMP    ??bufGet_0
    107              while(i<nBytes && i<pBuf->nBytes) {
    108                  pData[i]= pBuf->pData[pBuf->iHead];
   \                     ??bufGet_1:
   \   000027   8882         MOV     DPL,R0
   \   000029   8983         MOV     DPH,R1
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F5..         MOV     ?V0 + 4,A
   \   00002E   EE           MOV     A,R6
   \   00002F   25..         ADD     A,?V0 + 4
   \   000031   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000034   C0E0         PUSH    A
   \   000036   85....       MOV     ?V0 + 4,?V0 + 3
   \   000039   E5..         MOV     A,?V0 + 0
   \   00003B   25..         ADD     A,?V0 + 4
   \   00003D   F582         MOV     DPL,A
   \   00003F   E5..         MOV     A,?V0 + 1
   \   000041   3400         ADDC    A,#0x0
   \   000043   F583         MOV     DPH,A
   \   000045   D0E0         POP     A
   \   000047   F0           MOVX    @DPTR,A
    109                  pBuf->iHead++;
   \   000048   8882         MOV     DPL,R0
   \   00004A   8983         MOV     DPH,R1
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   04           INC     A
   \   00004E   F0           MOVX    @DPTR,A
    110                  if (pBuf->iHead==BUF_SIZE)
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   6440         XRL     A,#0x40
   \   000052   7002         JNZ     ??bufGet_2
    111                      pBuf->iHead= 0;
   \   000054   E4           CLR     A
   \   000055   F0           MOVX    @DPTR,A
    112                  i++;
   \                     ??bufGet_2:
   \   000056   05..         INC     ?V0 + 3
    113              }
   \                     ??bufGet_0:
   \   000058   E5..         MOV     A,?V0 + 3
   \   00005A   C3           CLR     C
   \   00005B   95..         SUBB    A,?V0 + 2
   \   00005D   500E         JNC     ??bufGet_3
   \   00005F   8C82         MOV     DPL,R4
   \   000061   8D83         MOV     DPH,R5
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F5..         MOV     ?V0 + 4,A
   \   000066   E5..         MOV     A,?V0 + 3
   \   000068   C3           CLR     C
   \   000069   95..         SUBB    A,?V0 + 4
   \   00006B   40BA         JC      ??bufGet_1
    114              pBuf->nBytes-= i;
   \                     ??bufGet_3:
   \   00006D   8C82         MOV     DPL,R4
   \   00006F   8D83         MOV     DPH,R5
   \   000071   E0           MOVX    A,@DPTR
   \   000072   C3           CLR     C
   \   000073   95..         SUBB    A,?V0 + 3
   \   000075   F0           MOVX    @DPTR,A
    115          
    116              // Critical section end
    117              halIntUnlock(s);
   \   000076                ; Setup parameters for call to function halIntUnlock
   \   000076   02....       LJMP    ?Subroutine0 & 0xFFFF
    118              return i;
    119          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003                REQUIRE ??Subroutine4_0
   \   000003                ; // Fall through to label ??Subroutine4_0
    120          
    121          
    122          /***********************************************************************************
    123          * @fn      bufPeek
    124          *
    125          * @brief   Read bytes from the buffer but leave them in the queue.
    126          *
    127          * @param   pBuf   - pointer to the ringbuffer
    128          *          pData  - pointer to data to be extracted
    129          *          nBytes - number of bytes
    130          *
    131          * @return  Bytes actually returned
    132          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    133          uint8 bufPeek(ringBuf_t *pBuf, uint8 *pData, uint8 nBytes)
   \                     bufPeek:
    134          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 0,R4
   \   00000B   8D..         MOV     ?V0 + 1,R5
   \   00000D   89..         MOV     ?V0 + 5,R1
    135              uint8 i,j;
    136              uint16 s;
    137          
    138              // Critical section start
    139              s = halIntLock();
   \   00000F                ; Setup parameters for call to function halIntLock
   \   00000F   12....       LCALL   ??halIntLock?relay
    140          
    141              i= 0;
   \   000012   75..00       MOV     ?V0 + 4,#0x0
    142              j= pBuf->iHead;
   \   000015   EE           MOV     A,R6
   \   000016   2441         ADD     A,#0x41
   \   000018   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00001B   F8           MOV     R0,A
   \   00001C   8026         SJMP    ??bufPeek_0
    143              while(i<nBytes && i<pBuf->nBytes) {
    144                  pData[i]= pBuf->pData[j];
   \                     ??bufPeek_1:
   \   00001E   88..         MOV     ?V0 + 2,R0
   \   000020   EE           MOV     A,R6
   \   000021   25..         ADD     A,?V0 + 2
   \   000023   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000026   C0E0         PUSH    A
   \   000028   85....       MOV     ?V0 + 2,?V0 + 4
   \   00002B   E5..         MOV     A,?V0 + 0
   \   00002D   25..         ADD     A,?V0 + 2
   \   00002F   F582         MOV     DPL,A
   \   000031   E5..         MOV     A,?V0 + 1
   \   000033   3400         ADDC    A,#0x0
   \   000035   F583         MOV     DPH,A
   \   000037   D0E0         POP     A
   \   000039   F0           MOVX    @DPTR,A
    145                  j++;
   \   00003A   08           INC     R0
    146                  if (j==BUF_SIZE)
   \   00003B   7440         MOV     A,#0x40
   \   00003D   68           XRL     A,R0
   \   00003E   7002         JNZ     ??bufPeek_2
    147                      j= 0;
   \   000040   7800         MOV     R0,#0x0
    148                  i++;
   \                     ??bufPeek_2:
   \   000042   05..         INC     ?V0 + 4
    149              }
   \                     ??bufPeek_0:
   \   000044   E5..         MOV     A,?V0 + 4
   \   000046   C3           CLR     C
   \   000047   95..         SUBB    A,?V0 + 5
   \   000049   500D         JNC     ??bufPeek_3
   \   00004B   EE           MOV     A,R6
   \   00004C   2440         ADD     A,#0x40
   \   00004E   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000051   F9           MOV     R1,A
   \   000052   E5..         MOV     A,?V0 + 4
   \   000054   C3           CLR     C
   \   000055   99           SUBB    A,R1
   \   000056   40C6         JC      ??bufPeek_1
    150          
    151              // Critical section end
    152              halIntUnlock(s);
   \                     ??bufPeek_3:
   \   000058                ; Setup parameters for call to function halIntUnlock
   \   000058   12....       LCALL   ??halIntUnlock?relay
    153              return i;
   \   00005B   A9..         MOV     R1,?V0 + 4
   \   00005D   02....       LJMP    ??Subroutine3_0 & 0xFFFF
    154          }
    155          
    156          
    157          /***********************************************************************************
    158          * @fn      bufNumBytes
    159          *
    160          * @brief   Return the byte count for the ring buffer.
    161          *
    162          * @param   pBuf- pointer to the buffer
    163          *
    164          * @return  Number of bytes present.
    165          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    166          uint8 bufNumBytes(ringBuf_t *pBuf)
   \                     bufNumBytes:
    167          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    168              return pBuf->nBytes;
   \   000004   EA           MOV     A,R2
   \   000005   2440         ADD     A,#0x40
   \   000007   F582         MOV     DPL,A
   \   000009   EB           MOV     A,R3
   \   00000A   12....       LCALL   ??Subroutine4_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00000D   F9           MOV     R1,A
   \   00000E   D083         POP     DPH
   \   000010   D082         POP     DPL
   \   000012   02....       LJMP    ?BRET
    169          }

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??bufInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bufInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??bufPut?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bufPut

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??bufGet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bufGet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??bufPeek?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bufPeek

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??bufNumBytes?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    bufNumBytes
    170          
    171          /***********************************************************************************
    172            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
    173          
    174            IMPORTANT: Your use of this Software is limited to those specific rights
    175            granted under the terms of a software license agreement between the user
    176            who downloaded the software, his/her employer (which must be your employer)
    177            and Texas Instruments Incorporated (the "License").  You may not use this
    178            Software unless you agree to abide by the terms of the License. The License
    179            limits your use, and you acknowledge, that the Software may not be modified,
    180            copied or distributed unless embedded on a Texas Instruments microcontroller
    181            or used solely and exclusively in conjunction with a Texas Instruments radio
    182            frequency transceiver, which is integrated into your product.  Other than for
    183            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
    184            works of, modify, distribute, perform, display or sell this Software and/or
    185            its documentation for any purpose.
    186          
    187            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
    188            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
    189            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
    190            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
    191            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
    192            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
    193            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
    194            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
    195            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
    196            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
    197            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
    198          
    199            Should you have any questions regarding your right to use this Software,
    200            contact Texas Instruments Incorporated at www.TI.com.
    201          ***********************************************************************************/
    202          

   Maximum stack usage in bytes:

     Function          ISTACK PSTACK XSTACK
     --------          ------ ------ ------
     bufGet                1      0     14
       -> halIntLock       0      0     28
       -> halIntUnlock     0      0     28
     bufInit               0      0     10
       -> halIntLock       0      0     20
       -> halIntUnlock     0      0     20
     bufNumBytes           2      0      0
     bufPeek               1      0     14
       -> halIntLock       0      0     28
       -> halIntUnlock     0      0     28
     bufPut                1      0     14
       -> halIntLock       0      0     28
       -> halIntUnlock     0      0     28


   Segment part sizes:

     Function/Label      Bytes
     --------------      -----
     bufInit               38
     ?Subroutine2          10
     bufPut               133
     ?Subroutine0           5
     ??Subroutine3_0        5
     ??Subroutine4_0        6
     bufGet               121
     ?Subroutine1           3
     bufPeek               96
     bufNumBytes           21
     ??bufInit?relay        6
     ??bufPut?relay         6
     ??bufGet?relay         6
     ??bufPeek?relay        6
     ??bufNumBytes?relay    6

 
 438 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
 
 468 bytes of CODE memory

Errors: none
Warnings: none
