###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.4.40412/W32 for 8051         13/Aug/2016  11:35:07 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Users\freeman\Documents\work\NBK\Canon\Nbk600EX #
#                           - RF\Components\mac\low_level\srf04\mac_tx.c      #
#    Command line       =  -f "C:\Users\freeman\Documents\work\NBK\Canon\Nbk6 #
#                          00EX - RF\Projects\zstack\Samples\SampleApp        #
#                          com\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg" #
#                           (-DCPU32MHZ -DROOT=__near_func                    #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg #
#                          " (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR    #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF0                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Components\mac\low_level\srf04\mac_tx.c"    #
#                          -D ZIGBEEPRO -D ZTOOL_P1 -lC                       #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\CoordinatorEB\List\" -lA              #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\CoordinatorEB\List\" --diag_suppress  #
#                          Pe001,Pa010 -o "C:\Users\freeman\Documents\work\NB #
#                          K\Canon\Nbk600EX - RF\Projects\zstack\Samples\Samp #
#                          leApp com\CC2530DB\CoordinatorEB\Obj\" -e --debug  #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data --nr_virtual_regs    #
#                          16 -I "C:\Users\freeman\Documents\work\NBK\Canon\N #
#                          bk600EX - RF\Projects\zstack\Samples\SampleApp     #
#                          com\CC2530DB\" -I "C:\Users\freeman\Documents\work #
#                          \NBK\Canon\Nbk600EX - RF\Projects\zstack\Samples\S #
#                          ampleApp com\CC2530DB\..\SOURCE\" -I               #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\ZMAIN\TI2530DB\" -I          #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MT\" -I     #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE #
#                          \" -I "C:\Users\freeman\Documents\work\NBK\Canon\N #
#                          bk600EX - RF\Projects\zstack\Samples\SampleApp     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\ #
#                          CC2530EB\" -I "C:\Users\freeman\Documents\work\NBK #
#                          \Canon\Nbk600EX - RF\Projects\zstack\Samples\Sampl #
#                          eApp com\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\M #
#                          CU\CCSOC\" -I "C:\Users\freeman\Documents\work\NBK #
#                          \Canon\Nbk600EX - RF\Projects\zstack\Samples\Sampl #
#                          eApp com\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\I #
#                          NCLUDE\" -I "C:\Users\freeman\Documents\work\NBK\C #
#                          anon\Nbk600EX - RF\Projects\zstack\Samples\SampleA #
#                          pp com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF #
#                          \" -I "C:\Users\freeman\Documents\work\NBK\Canon\N #
#                          bk600EX - RF\Projects\zstack\Samples\SampleApp     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\" #
#                           -I "C:\Users\freeman\Documents\work\NBK\Canon\Nbk #
#                          600EX - RF\Projects\zstack\Samples\SampleApp       #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\" #
#                           -I "C:\Users\freeman\Documents\work\NBK\Canon\Nbk #
#                          600EX - RF\Projects\zstack\Samples\SampleApp       #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ #
#                          " -I "C:\Users\freeman\Documents\work\NBK\Canon\Nb #
#                          k600EX - RF\Projects\zstack\Samples\SampleApp      #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\" #
#                           -I "C:\Users\freeman\Documents\work\NBK\Canon\Nbk #
#                          600EX - RF\Projects\zstack\Samples\SampleApp       #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" #
#                           -I "C:\Users\freeman\Documents\work\NBK\Canon\Nbk #
#                          600EX - RF\Projects\zstack\Samples\SampleApp       #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\"  #
#                          -I "C:\Users\freeman\Documents\work\NBK\Canon\Nbk6 #
#                          00EX - RF\Projects\zstack\Samples\SampleApp        #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I   #
#                          "C:\Users\freeman\Documents\work\NBK\Canon\Nbk600E #
#                          X - RF\Projects\zstack\Samples\SampleApp           #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SA #
#                          DDR\" -I "C:\Users\freeman\Documents\work\NBK\Cano #
#                          n\Nbk600EX - RF\Projects\zstack\Samples\SampleApp  #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SD #
#                          ATA\" -I "C:\Users\freeman\Documents\work\NBK\Cano #
#                          n\Nbk600EX - RF\Projects\zstack\Samples\SampleApp  #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE #
#                          \" -I "C:\Users\freeman\Documents\work\NBK\Canon\N #
#                          bk600EX - RF\Projects\zstack\Samples\SampleApp     #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LE #
#                          VEL\" -I "C:\Users\freeman\Documents\work\NBK\Cano #
#                          n\Nbk600EX - RF\Projects\zstack\Samples\SampleApp  #
#                          com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\srf04\" -I "C:\Users\freeman\Documents\work\NBK #
#                          \Canon\Nbk600EX - RF\Projects\zstack\Samples\Sampl #
#                          eApp com\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LO #
#                          W_LEVEL\srf04\SINGLE_CHIP\" -Ohz                   #
#                          --require_prototypes                               #
#    List file          =  C:\Users\freeman\Documents\work\NBK\Canon\Nbk600EX #
#                           - RF\Projects\zstack\Samples\SampleApp            #
#                          com\CC2530DB\CoordinatorEB\List\mac_tx.lst         #
#    Object file        =  C:\Users\freeman\Documents\work\NBK\Canon\Nbk600EX #
#                           - RF\Projects\zstack\Samples\SampleApp            #
#                          com\CC2530DB\CoordinatorEB\Obj\mac_tx.r51          #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\freeman\Documents\work\NBK\Canon\Nbk600EX - RF\Components\mac\low_level\srf04\mac_tx.c
      1          /**************************************************************************************************
      2            Filename:       mac_tx.c
      3            Revised:        $Date: 2007-10-15 14:56:36 -0700 (Mon, 15 Oct 2007) $
      4            Revision:       $Revision: 15687 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2006-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /* ------------------------------------------------------------------------------------------------
     41           *                                          Includes
     42           * ------------------------------------------------------------------------------------------------
     43           */
     44          
     45          /* hal */
     46          #include "hal_types.h"
     47          #include "hal_defs.h"
     48          #include "hal_mcu.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe1
   \   unsigned char volatile __sfr RFST
   \                     RFST:
   \   000000                DS 1
     49          #include "hal_mac_cfg.h"
     50          
     51          /* high-level */
     52          #include "mac_spec.h"
     53          #include "mac_pib.h"
     54          
     55          /* exported low-level */
     56          #include "mac_low_level.h"
     57          
     58          /* low-level specific */
     59          #include "mac_tx.h"
     60          #include "mac_backoff_timer.h"
     61          #include "mac_rx.h"
     62          #include "mac_rx_onoff.h"
     63          #include "mac_radio.h"
     64          #include "mac_sleep.h"
     65          
     66          /* target specific */
     67          #include "mac_radio_defs.h"
     68          
     69          /* debug */
     70          #include "mac_assert.h"
     71          
     72          
     73          /* ------------------------------------------------------------------------------------------------
     74           *                                            Defines
     75           * ------------------------------------------------------------------------------------------------
     76           */
     77          #define MFR_LEN                   MAC_FCS_FIELD_LEN
     78          #define PREPENDED_BYTE_LEN        1
     79          
     80          
     81          /* ------------------------------------------------------------------------------------------------
     82           *                                         Global Constants
     83           * ------------------------------------------------------------------------------------------------
     84           */
     85          
     86          /*
     87           *  This is the time, in backoffs, required to set up a slotted transmit.
     88           *  It is exported to high level so that code can schedule enough time
     89           *  for slotted transmits.
     90           *
     91           *  A default is provided if a value is not specified.  If the default
     92           *  is not appropriate, a #define should be added within hal_mac_cfg.h.
     93           */
     94          #ifndef HAL_MAC_TX_SLOTTED_DELAY
     95          #define HAL_MAC_TX_SLOTTED_DELAY    3
     96          #endif

   \                                 In  segment XDATA_I, align 1, keep-with-next
     97          uint8 const macTxSlottedDelay = HAL_MAC_TX_SLOTTED_DELAY;
   \                     macTxSlottedDelay:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for macTxSlottedDelay>`
   \   000001                REQUIRE __INIT_XDATA_I
     98          
     99          
    100          /* ------------------------------------------------------------------------------------------------
    101           *                                         Global Variables
    102           * ------------------------------------------------------------------------------------------------
    103           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    104          uint8 macTxActive;
   \                     macTxActive:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    105          uint8 macTxType;
   \                     macTxType:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    106          uint8 macTxBe;
   \                     macTxBe:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    107          uint8 macTxCsmaBackoffDelay;
   \                     macTxCsmaBackoffDelay:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    108          
    109          
    110          /* ------------------------------------------------------------------------------------------------
    111           *                                         Local Variables
    112           * ------------------------------------------------------------------------------------------------
    113           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    114          static uint8 nb;
   \                     nb:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    115          static uint8 txSeqn;
   \                     txSeqn:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    116          static uint8 txAckReq;
   \                     txAckReq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          static uint8 txRetransmitFlag;
   \                     txRetransmitFlag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    118          
    119          
    120          /* ------------------------------------------------------------------------------------------------
    121           *                                         Local Prototypes
    122           * ------------------------------------------------------------------------------------------------
    123           */
    124          static void txCsmaPrep(void);
    125          static void txGo(void);
    126          static void txCsmaGo(void);
    127          static void txComplete(uint8 status);
    128          void macWaitSendOk(void);
    129          
    130          
    131          /**************************************************************************************************
    132           * @fn          macTxInit
    133           *
    134           * @brief       Initialize variables for tx module.
    135           *
    136           * @param       none
    137           *
    138           * @return      none
    139           **************************************************************************************************
    140           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    141          MAC_INTERNAL_API void macTxInit(void)
   \                     macTxInit:
    142          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    143            macTxActive      = MAC_TX_ACTIVE_NO_ACTIVITY;
   \   000004   02....       LJMP    ?Subroutine0 & 0xFFFF
    144            txRetransmitFlag = 0;
    145          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   90....       MOV     DPTR,#macTxActive
   \   000003   E4           CLR     A
   \   000004   F0           MOVX    @DPTR,A
   \   000005   90....       MOV     DPTR,#txRetransmitFlag
   \   000008   F0           MOVX    @DPTR,A
   \   000009                REQUIRE ??Subroutine8_0
   \   000009                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    146          
    147          
    148          /**************************************************************************************************
    149           * @fn          macTxHaltCleanup
    150           *
    151           * @brief       -
    152           *
    153           * @param       none
    154           *
    155           * @return      none
    156           **************************************************************************************************
    157           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    158          MAC_INTERNAL_API void macTxHaltCleanup(void)
   \                     macTxHaltCleanup:
    159          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    160            MAC_RADIO_TX_RESET();
   \   000004                ; Setup parameters for call to function macCspTxReset
   \   000004   12....       LCALL   ??macCspTxReset?relay
    161            macTxInit();
   \   000007   02....       LJMP    ?Subroutine0 & 0xFFFF
    162          }
    163          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    164          MAC_INTERNAL_API void macWaitSendOk(void)				//cbyi
   \                     macWaitSendOk:
    165          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    166          	while(macTxActive);
   \                     ??macWaitSendOk_0:
   \   000004   90....       MOV     DPTR,#macTxActive
   \   000007   E0           MOVX    A,@DPTR
   \   000008   70FA         JNZ     ??macWaitSendOk_0
    167          }
   \   00000A   02....       LJMP    ??Subroutine8_0 & 0xFFFF
    168          
    169          
    170          /**************************************************************************************************
    171           * @fn          macTxFrame
    172           *
    173           * @brief       Transmit the frame pointed to by pMacDataTx with the specified type.
    174           *              NOTE! It is not legal to call this function from interrupt context.
    175           *
    176           * @param       txType - type of transmit
    177           *
    178           * @return      none
    179           **************************************************************************************************
    180           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    181          MAC_INTERNAL_API void macTxFrame(uint8 txType)
   \                     macTxFrame:
    182          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    183            MAC_ASSERT(!macTxActive);            /* transmit on top of transmit */
   \   000007   90....       MOV     DPTR,#macTxActive
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   6003         JZ      ??macTxFrame_0
   \   00000D                ; Setup parameters for call to function halAssertHandler
   \   00000D   12....       LCALL   ??halAssertHandler?relay
    184          
    185            /* mark transmit as active */
    186            macTxActive = MAC_TX_ACTIVE_INITIALIZE;
   \                     ??macTxFrame_0:
   \   000010   90....       MOV     DPTR,#macTxActive
   \   000013   7401         MOV     A,#0x1
   \   000015   F0           MOVX    @DPTR,A
    187          
    188            /*
    189             *  The MAC will not enter sleep mode if there is an active transmit.  However, if macSleep() is
    190             *  ever called from interrupt context, it possible to enter sleep state after a transmit is
    191             *  intiated but before macTxActive is set.  To recover from this, the transmit must be aborted
    192             *  and proper notificiation given to high-level.
    193             */
    194            if (macSleepState != MAC_SLEEP_STATE_AWAKE)
   \   000016   90....       MOV     DPTR,#macSleepState
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   6008         JZ      ??macTxFrame_1
    195            {
    196              /* notify high-level that transmit had to be aborted */
    197              txComplete(MAC_TX_ABORTED);
   \   00001C                ; Setup parameters for call to function txComplete
   \   00001C   791D         MOV     R1,#0x1d
   \   00001E   12....       LCALL   ??txComplete?relay
    198          
    199              /* exit from transmit logic */
    200              return;
   \   000021   02....       LJMP    ??macTxFrame_2 & 0xFFFF
    201            }
    202          
    203            /* save transmit type */
    204            macTxType = txType;
   \                     ??macTxFrame_1:
   \   000024   EE           MOV     A,R6
   \   000025   90....       MOV     DPTR,#macTxType
   \   000028   F0           MOVX    @DPTR,A
    205          
    206            /*-------------------------------------------------------------------------------
    207             *  Prepare for transmit.
    208             */
    209            if (macTxType == MAC_TX_TYPE_SLOTTED)
   \   000029   6402         XRL     A,#0x2
   \   00002B   7005         JNZ     ??macTxFrame_3
    210            {
    211              MAC_RADIO_TX_PREP_SLOTTED();
   \   00002D                ; Setup parameters for call to function macCspTxPrepSlotted
   \   00002D   12....       LCALL   ??macCspTxPrepSlotted?relay
   \   000030   8045         SJMP    ??macTxFrame_4
    212            }
    213            else
    214            {
    215              MAC_ASSERT((macTxType == MAC_TX_TYPE_SLOTTED_CSMA) || (macTxType == MAC_TX_TYPE_UNSLOTTED_CSMA));
   \                     ??macTxFrame_3:
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6007         JZ      ??macTxFrame_5
   \   000035   6401         XRL     A,#0x1
   \   000037   6003         JZ      ??macTxFrame_5
   \   000039                ; Setup parameters for call to function halAssertHandler
   \   000039   12....       LCALL   ??halAssertHandler?relay
    216          
    217              nb = 0;
   \                     ??macTxFrame_5:
   \   00003C   90....       MOV     DPTR,#nb
   \   00003F   E4           CLR     A
   \   000040   F0           MOVX    @DPTR,A
    218              macTxBe = (pMacDataTx->internal.txOptions & MAC_TXOPTION_ALT_BE) ? macPib.altBe : macPib.minBe;
   \   000041   90....       MOV     DPTR,#pMacDataTx
   \   000044   E0           MOVX    A,@DPTR
   \   000045   240E         ADD     A,#0xe
   \   000047   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00004A   A2E6         MOV     C,0xE0 /* A   */.6
   \   00004C   5005         JNC     ??macTxFrame_6
   \   00004E   90....       MOV     DPTR,#macPib + 58
   \   000051   8003         SJMP    ??macTxFrame_7
   \                     ??macTxFrame_6:
   \   000053   90....       MOV     DPTR,#macPib + 28
   \                     ??macTxFrame_7:
   \   000056   E0           MOVX    A,@DPTR
   \   000057   90....       MOV     DPTR,#macTxBe
   \   00005A   12....       LCALL   ?Subroutine6 & 0xFFFF
    219          
    220              if ((macTxType == MAC_TX_TYPE_SLOTTED_CSMA) && (macPib.battLifeExt))
   \                     ??CrossCallReturnLabel_6:
   \   00005D   7015         JNZ     ??macTxFrame_8
   \   00005F   90....       MOV     DPTR,#macPib + 3
   \   000062   E0           MOVX    A,@DPTR
   \   000063   600F         JZ      ??macTxFrame_8
    221              {
    222                macTxBe = MIN(2, macTxBe);
   \   000065   90....       MOV     DPTR,#macTxBe
   \   000068   E0           MOVX    A,@DPTR
   \   000069   C3           CLR     C
   \   00006A   9403         SUBB    A,#0x3
   \   00006C   4004         JC      ??macTxFrame_9
   \   00006E   7402         MOV     A,#0x2
   \   000070   8001         SJMP    ??macTxFrame_10
   \                     ??macTxFrame_9:
   \   000072   E0           MOVX    A,@DPTR
   \                     ??macTxFrame_10:
   \   000073   F0           MOVX    @DPTR,A
    223              }
    224          
    225              txCsmaPrep();
   \                     ??macTxFrame_8:
   \   000074                ; Setup parameters for call to function txCsmaPrep
   \   000074   12....       LCALL   ??txCsmaPrep?relay
    226            }
    227          
    228            /*-------------------------------------------------------------------------------
    229             *  Load transmit FIFO unless this is a retransmit.  No need to write
    230             *  the FIFO again in that case.
    231             */
    232            if (!txRetransmitFlag)
   \                     ??macTxFrame_4:
   \   000077   90....       MOV     DPTR,#txRetransmitFlag
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   705A         JNZ     ??macTxFrame_11
    233            {
    234              uint8 * p;
    235              uint8   lenMhrMsdu;
    236          
    237              MAC_ASSERT(pMacDataTx != NULL); /* must have data to transmit */
   \   00007D   90....       MOV     DPTR,#pMacDataTx
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F8           MOV     R0,A
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   F9           MOV     R1,A
   \   000085   E8           MOV     A,R0
   \   000086   49           ORL     A,R1
   \   000087   7003         JNZ     ??macTxFrame_12
   \   000089                ; Setup parameters for call to function halAssertHandler
   \   000089   12....       LCALL   ??halAssertHandler?relay
    238          
    239              /* save needed parameters */
    240              txAckReq = MAC_ACK_REQUEST(pMacDataTx->msdu.p);
   \                     ??macTxFrame_12:
   \   00008C   90....       MOV     DPTR,#pMacDataTx
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   2402         ADD     A,#0x2
   \   000092   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000095   FA           MOV     R2,A
   \   000096   A3           INC     DPTR
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F583         MOV     DPH,A
   \   00009A   8A82         MOV     DPL,R2
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   5420         ANL     A,#0x20
   \   00009F   90....       MOV     DPTR,#txAckReq
   \   0000A2   F0           MOVX    @DPTR,A
    241              txSeqn   = MAC_SEQ_NUMBER(pMacDataTx->msdu.p);
   \   0000A3   8882         MOV     DPL,R0
   \   0000A5   8983         MOV     DPH,R1
   \   0000A7   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   0000AA   E0           MOVX    A,@DPTR
   \   0000AB   90....       MOV     DPTR,#txSeqn
   \   0000AE   F0           MOVX    @DPTR,A
    242          
    243              /* set length of frame (note: use of term msdu is a misnomer, here it's actually mhr + msdu) */
    244              lenMhrMsdu = pMacDataTx->msdu.len;
   \   0000AF   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   FA           MOV     R2,A
    245          
    246              /* calling code guarantees an unused prepended byte  */
    247              p = pMacDataTx->msdu.p - PREPENDED_BYTE_LEN;
   \   0000B4   8882         MOV     DPL,R0
   \   0000B6   8983         MOV     DPH,R1
   \   0000B8   E0           MOVX    A,@DPTR
   \   0000B9   24FF         ADD     A,#-0x1
   \   0000BB   F8           MOV     R0,A
   \   0000BC   A3           INC     DPTR
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   34FF         ADDC    A,#-0x1
   \   0000C0   F9           MOV     R1,A
   \   0000C1   8882         MOV     DPL,R0
   \   0000C3   8983         MOV     DPH,R1
    248          
    249              /* first byte of buffer is length of MPDU */
    250              *p = lenMhrMsdu + MFR_LEN;
   \   0000C5   7402         MOV     A,#0x2
   \   0000C7   2A           ADD     A,R2
   \   0000C8   F0           MOVX    @DPTR,A
    251          
    252              /*
    253               *  Flush the TX FIFO.  This is necessary in case the previous transmit was never
    254               *  actually sent (e.g. CSMA failed without strobing TXON).  If bytes are written to
    255               *  the FIFO but not transmitted, they remain in the FIFO to be transmitted whenever
    256               *  a strobe of TXON does happen.
    257               */
    258              MAC_RADIO_FLUSH_TX_FIFO();
   \   0000C9   75E1EE       MOV     0xe1,#-0x12
    259          
    260              /* write bytes to FIFO, prepended byte is included, MFR is not (it's generated by hardware) */
    261              MAC_RADIO_WRITE_TX_FIFO(p, PREPENDED_BYTE_LEN + lenMhrMsdu);
   \   0000CC                ; Setup parameters for call to function macMemWriteTxFifo
   \   0000CC   7401         MOV     A,#0x1
   \   0000CE   2A           ADD     A,R2
   \   0000CF   F9           MOV     R1,A
   \   0000D0   AA82         MOV     R2,DPL
   \   0000D2   AB83         MOV     R3,DPH
   \   0000D4   12....       LCALL   ??macMemWriteTxFifo?relay
    262            }
    263          
    264            /*-------------------------------------------------------------------------------
    265             *  If not receiving, start the transmit.  If receive is active
    266             *  queue up the transmit.
    267             *
    268             *  Critical sections around the state change prevents any sort of race condition
    269             *  with  macTxStartQueuedFrame().  This guarantees function txGo() will only be
    270             *  called once.
    271             */
    272            {
    273              halIntState_t  s;
    274          
    275              HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macTxFrame_11:
   \   0000D7   A2AF         MOV     C,0xa8.7
   \   0000D9   E4           CLR     A
   \   0000DA   33           RLC     A
   \   0000DB   F8           MOV     R0,A
   \   0000DC   C2AF         CLR     0xa8.7
    276              if (!macRxActive && !macRxOutgoingAckFlag)
   \   0000DE   90....       MOV     DPTR,#macRxActive
   \   0000E1   E0           MOVX    A,@DPTR
   \   0000E2   700E         JNZ     ??macTxFrame_13
   \   0000E4   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   7008         JNZ     ??macTxFrame_13
    277              {
    278                macTxActive = MAC_TX_ACTIVE_GO;
   \   0000EA   90....       MOV     DPTR,#macTxActive
   \   0000ED   12....       LCALL   ?Subroutine4 & 0xFFFF
    279                HAL_EXIT_CRITICAL_SECTION(s);
    280                txGo();
    281              }
   \                     ??CrossCallReturnLabel_2:
   \   0000F0   800B         SJMP    ??macTxFrame_2
    282              else
    283              {
    284                macTxActive = MAC_TX_ACTIVE_QUEUED;
   \                     ??macTxFrame_13:
   \   0000F2   90....       MOV     DPTR,#macTxActive
   \   0000F5   7402         MOV     A,#0x2
   \   0000F7   F0           MOVX    @DPTR,A
    285                HAL_EXIT_CRITICAL_SECTION(s);
   \   0000F8   E8           MOV     A,R0
   \   0000F9   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000FB   92AF         MOV     0xa8.7,C
    286              }
    287            }
   \                     ??macTxFrame_2:
   \   0000FD   02....       LJMP    ?Subroutine1 & 0xFFFF
   \   000100                REQUIRE RFST
   \   000100                REQUIRE _A_IEN0
    288          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F8           MOV     R0,A
   \   000001   A3           INC     DPTR
   \   000002   E0           MOVX    A,@DPTR
   \   000003   3400         ADDC    A,#0x0
   \   000005   F9           MOV     R1,A
   \   000006   8882         MOV     DPL,R0
   \   000008   8983         MOV     DPH,R1
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function macTxFrame
   \   000001   90....       MOV     DPTR,#macTxType
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7483         MOV     A,#-0x7d
   \   000002   F0           MOVX    @DPTR,A
   \   000003   E8           MOV     A,R0
   \   000004   A2E0         MOV     C,0xE0 /* A   */.0
   \   000006   92AF         MOV     0xa8.7,C
   \   000008                ; Setup parameters for call to function txGo
   \   000008                ; Setup parameters for call to function txGo
   \   000008   12....       LCALL   ??txGo?relay
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV     DPTR,#pMacDataTx
   \   000003   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000006   A3           INC     DPTR
   \   000007   A3           INC     DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8A82         MOV     DPL,R2
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   22           RET
    289          
    290          
    291          /*=================================================================================================
    292           * @fn          txCsmaPrep
    293           *
    294           * @brief       Prepare/initialize for a CSMA transmit.
    295           *
    296           * @param       none
    297           *
    298           * @return      none
    299           *=================================================================================================
    300           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    301          static void txCsmaPrep(void)
   \                     txCsmaPrep:
    302          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    303            macTxCsmaBackoffDelay = macRadioRandomByte() & ((1 << macTxBe) - 1);
   \   000005                ; Setup parameters for call to function macRadioRandomByte
   \   000005   12....       LCALL   ??macRadioRandomByte?relay
   \   000008   75..01       MOV     ?V0 + 0,#0x1
   \   00000B   75..00       MOV     ?V0 + 1,#0x0
   \   00000E   90....       MOV     DPTR,#macTxBe
   \   000011   E0           MOVX    A,@DPTR
   \   000012   78..         MOV     R0,#?V0 + 0
   \   000014   12....       LCALL   ?S_SHL
   \   000017   E5..         MOV     A,?V0 + 0
   \   000019   14           DEC     A
   \   00001A   59           ANL     A,R1
   \   00001B   90....       MOV     DPTR,#macTxCsmaBackoffDelay
   \   00001E   12....       LCALL   ?Subroutine6 & 0xFFFF
    304          
    305            if (macTxType == MAC_TX_TYPE_SLOTTED_CSMA)
   \                     ??CrossCallReturnLabel_7:
   \   000021   7005         JNZ     ??txCsmaPrep_0
    306            {
    307              MAC_RADIO_TX_PREP_CSMA_SLOTTED();
   \   000023                ; Setup parameters for call to function macCspTxPrepCsmaSlotted
   \   000023   12....       LCALL   ??macCspTxPrepCsmaSlotted?relay
   \   000026   8003         SJMP    ??txCsmaPrep_1
    308            }
    309            else
    310            {
    311              MAC_RADIO_TX_PREP_CSMA_UNSLOTTED();
   \                     ??txCsmaPrep_0:
   \   000028                ; Setup parameters for call to function macCspTxPrepCsmaUnslotted
   \   000028   12....       LCALL   ??macCspTxPrepCsmaUnslotted?relay
    312            }
    313          }
   \                     ??txCsmaPrep_1:
   \   00002B                REQUIRE ?Subroutine2
   \   00002B                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    314          
    315          
    316          /*=================================================================================================
    317           * @fn          txGo
    318           *
    319           * @brief       Start a transmit going.
    320           *
    321           * @param       none
    322           *
    323           * @return      none
    324           *=================================================================================================
    325           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    326          static void txGo(void)
   \                     txGo:
    327          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    328            /*
    329             *  If execution has reached this point, any transmitted ACK has long since completed.  It is
    330             *  possible though that there is still a pending callback.  If so, it is irrelevant and needs to
    331             *  be canceled at this point.
    332             */
    333            MAC_RADIO_CANCEL_ACK_TX_DONE_CALLBACK();
   \   000004   9061A4       MOV     DPTR,#0x61a4
   \   000007   E0           MOVX    A,@DPTR
   \   000008   C2E0         CLR     0xE0 /* A   */.0
   \   00000A   F0           MOVX    @DPTR,A
    334            macRxOutgoingAckFlag = 0;
   \   00000B   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   00000E   E4           CLR     A
   \   00000F   12....       LCALL   ?Subroutine6 & 0xFFFF
    335          
    336            /* based on type of transmit, call the correct "go" functionality */
    337            if (macTxType == MAC_TX_TYPE_SLOTTED)
   \                     ??CrossCallReturnLabel_8:
   \   000012   6402         XRL     A,#0x2
   \   000014   7005         JNZ     ??txGo_0
    338            {
    339              MAC_RADIO_TX_GO_SLOTTED();
   \   000016                ; Setup parameters for call to function macCspTxGoSlotted
   \   000016   12....       LCALL   ??macCspTxGoSlotted?relay
   \   000019   8003         SJMP    ??txGo_1
    340            }
    341            else
    342            {
    343              txCsmaGo();
   \                     ??txGo_0:
   \   00001B                ; Setup parameters for call to function txCsmaGo
   \   00001B   12....       LCALL   ??txCsmaGo?relay
    344            }
    345          }
   \                     ??txGo_1:
   \   00001E   80..         SJMP    ??Subroutine8_0
    346          
    347          
    348          /*=================================================================================================
    349           * @fn          txCsmaGo
    350           *
    351           * @brief       Start a CSMA transmit going.
    352           *
    353           * @param       none
    354           *
    355           * @return      none
    356           *=================================================================================================
    357           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    358          static void txCsmaGo(void)
   \                     txCsmaGo:
    359          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    360            if (macTxType == MAC_TX_TYPE_SLOTTED_CSMA)
   \   000004   90....       MOV     DPTR,#macTxType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7014         JNZ     ??txCsmaGo_0
    361            {
    362              if (macTxCsmaBackoffDelay >= macDataTxTimeAvailable())
   \   00000A                ; Setup parameters for call to function macDataTxTimeAvailable
   \   00000A   12....       LCALL   ??macDataTxTimeAvailable?relay
   \   00000D   E9           MOV     A,R1
   \   00000E   F8           MOV     R0,A
   \   00000F   90....       MOV     DPTR,#macTxCsmaBackoffDelay
   \   000012   E0           MOVX    A,@DPTR
   \   000013   C3           CLR     C
   \   000014   98           SUBB    A,R0
   \   000015   4007         JC      ??txCsmaGo_0
    363              {
    364                txComplete(MAC_NO_TIME);
   \   000017                ; Setup parameters for call to function txComplete
   \   000017   791C         MOV     R1,#0x1c
   \   000019   12....       LCALL   ??txComplete?relay
    365                return;
   \   00001C   8003         SJMP    ??txCsmaGo_1
    366              }
    367              MAC_RADIO_TX_GO_SLOTTED_CSMA();
   \                     ??txCsmaGo_0:
   \   00001E                ; Setup parameters for call to function macCspTxGoCsma
   \   00001E   12....       LCALL   ??macCspTxGoCsma?relay
    368            }
   \                     ??txCsmaGo_1:
   \   000021   80..         SJMP    ??Subroutine8_0
    369            else
    370            {
    371              MAC_RADIO_TX_GO_CSMA();
    372            }
    373          }
    374          
    375          
    376          /**************************************************************************************************
    377           * @fn          macTxFrameRetransmit
    378           *
    379           * @brief       Retransmit the last frame.
    380           *
    381           * @param       none
    382           *
    383           * @return      none
    384           **************************************************************************************************
    385           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    386          MAC_INTERNAL_API void macTxFrameRetransmit(void)
   \                     macTxFrameRetransmit:
    387          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    388            txRetransmitFlag = 1;
   \   000004   90....       MOV     DPTR,#txRetransmitFlag
   \   000007   7401         MOV     A,#0x1
   \   000009   12....       LCALL   ?Subroutine6 & 0xFFFF
    389            macTxFrame(macTxType);
   \                     ??CrossCallReturnLabel_9:
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??macTxFrame?relay
    390          }
   \   000010   80..         SJMP    ??Subroutine8_0
    391          
    392          
    393          /**************************************************************************************************
    394           * @fn          macTxStartQueuedFrame
    395           *
    396           * @brief       See if there is a queued frame waiting to transmit.  If so, initiate
    397           *              the transmit now.
    398           *
    399           * @param       none
    400           *
    401           * @return      none
    402           **************************************************************************************************
    403           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    404          MAC_INTERNAL_API void macTxStartQueuedFrame(void)
   \                     macTxStartQueuedFrame:
    405          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    406            halIntState_t  s;
    407          
    408            MAC_ASSERT(!macRxActive && !macRxOutgoingAckFlag); /* queued frames should not transmit in middle of a receive */
   \   000004   90....       MOV     DPTR,#macRxActive
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7006         JNZ     ??macTxStartQueuedFrame_0
   \   00000A   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6003         JZ      ??macTxStartQueuedFrame_1
   \                     ??macTxStartQueuedFrame_0:
   \   000010                ; Setup parameters for call to function halAssertHandler
   \   000010   12....       LCALL   ??halAssertHandler?relay
    409          
    410            /*
    411             *  Critical sections around the state change prevents any sort of race condition
    412             *  with macTxFrame().  This guarantees function txGo() will only be be called once.
    413             */
    414            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macTxStartQueuedFrame_1:
   \   000013   A2AF         MOV     C,0xa8.7
   \   000015   E4           CLR     A
   \   000016   33           RLC     A
   \   000017   F8           MOV     R0,A
   \   000018   C2AF         CLR     0xa8.7
    415            if (macTxActive == MAC_TX_ACTIVE_QUEUED)
   \   00001A   90....       MOV     DPTR,#macTxActive
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   6402         XRL     A,#0x2
   \   000020   7005         JNZ     ??macTxStartQueuedFrame_2
    416            {
    417              macTxActive = MAC_TX_ACTIVE_GO;
   \   000022   12....       LCALL   ?Subroutine4 & 0xFFFF
    418              HAL_EXIT_CRITICAL_SECTION(s);
    419              txGo();
    420            }
   \                     ??CrossCallReturnLabel_3:
   \   000025   8005         SJMP    ??macTxStartQueuedFrame_3
    421            else
    422            {
    423              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxStartQueuedFrame_2:
   \   000027   E8           MOV     A,R0
   \   000028   A2E0         MOV     C,0xE0 /* A   */.0
   \   00002A   92AF         MOV     0xa8.7,C
    424            }
    425          }
   \                     ??macTxStartQueuedFrame_3:
   \   00002C   80..         SJMP    ??Subroutine8_0
   \   00002E                REQUIRE _A_IEN0
    426          
    427          
    428          /**************************************************************************************************
    429           * @fn          macTxChannelBusyCallback
    430           *
    431           * @brief       This callback is executed if a CSMA transmit was attempted but the channel
    432           *              was busy.
    433           *
    434           * @param       none
    435           *
    436           * @return      none
    437           **************************************************************************************************
    438           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    439          MAC_INTERNAL_API void macTxChannelBusyCallback(void)
   \                     macTxChannelBusyCallback:
    440          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    441            MAC_ASSERT((macTxType == MAC_TX_TYPE_SLOTTED_CSMA) || (macTxType == MAC_TX_TYPE_UNSLOTTED_CSMA));
   \   000005   90....       MOV     DPTR,#macTxType
   \   000008   E0           MOVX    A,@DPTR
   \   000009   6007         JZ      ??macTxChannelBusyCallback_0
   \   00000B   6401         XRL     A,#0x1
   \   00000D   6003         JZ      ??macTxChannelBusyCallback_0
   \   00000F                ; Setup parameters for call to function halAssertHandler
   \   00000F   12....       LCALL   ??halAssertHandler?relay
    442          
    443            /* turn off receiver if allowed */
    444            macTxActive = MAC_TX_ACTIVE_CHANNEL_BUSY;
   \                     ??macTxChannelBusyCallback_0:
   \   000012   90....       MOV     DPTR,#macTxActive
   \   000015   7404         MOV     A,#0x4
   \   000017   F0           MOVX    @DPTR,A
    445            macRxOffRequest();
   \   000018                ; Setup parameters for call to function macRxOffRequest
   \   000018   12....       LCALL   ??macRxOffRequest?relay
    446          
    447            /*  clear channel assement failed, follow through with CSMA algorithm */
    448            nb++;
   \   00001B   90....       MOV     DPTR,#nb
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   04           INC     A
   \   000020   F0           MOVX    @DPTR,A
    449            if (nb > macPib.maxCsmaBackoffs)
   \   000021   F8           MOV     R0,A
   \   000022   90....       MOV     DPTR,#macPib + 27
   \   000025   E0           MOVX    A,@DPTR
   \   000026   C3           CLR     C
   \   000027   98           SUBB    A,R0
   \   000028   5007         JNC     ??macTxChannelBusyCallback_1
    450            {
    451              txComplete(MAC_CHANNEL_ACCESS_FAILURE);
   \   00002A                ; Setup parameters for call to function txComplete
   \   00002A   79E1         MOV     R1,#-0x1f
   \   00002C   12....       LCALL   ??txComplete?relay
   \   00002F   8032         SJMP    ??macTxChannelBusyCallback_2
    452            }
    453            else
    454            {
    455              macTxBe = MIN(macTxBe+1, macPib.maxBe);
   \                     ??macTxChannelBusyCallback_1:
   \   000031   90....       MOV     DPTR,#macPib + 39
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FA           MOV     R2,A
   \   000036   90....       MOV     DPTR,#macTxBe
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   2401         ADD     A,#0x1
   \   00003C   F8           MOV     R0,A
   \   00003D   E4           CLR     A
   \   00003E   3400         ADDC    A,#0x0
   \   000040   F9           MOV     R1,A
   \   000041   8A..         MOV     ?V0 + 0,R2
   \   000043   E8           MOV     A,R0
   \   000044   95..         SUBB    A,?V0 + 0
   \   000046   E9           MOV     A,R1
   \   000047   9400         SUBB    A,#0x0
   \   000049   C3           CLR     C
   \   00004A   65D0         XRL     A,PSW
   \   00004C   33           RLC     A
   \   00004D   5004         JNC     ??macTxChannelBusyCallback_3
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   04           INC     A
   \   000051   8001         SJMP    ??macTxChannelBusyCallback_4
   \                     ??macTxChannelBusyCallback_3:
   \   000053   EA           MOV     A,R2
   \                     ??macTxChannelBusyCallback_4:
   \   000054   FE           MOV     R6,A
   \   000055   EE           MOV     A,R6
   \   000056   F0           MOVX    @DPTR,A
    456              txCsmaPrep();
   \   000057                ; Setup parameters for call to function txCsmaPrep
   \   000057   12....       LCALL   ??txCsmaPrep?relay
    457              macTxActive = MAC_TX_ACTIVE_GO;
   \   00005A   90....       MOV     DPTR,#macTxActive
   \   00005D   7483         MOV     A,#-0x7d
   \   00005F   F0           MOVX    @DPTR,A
    458              txCsmaGo();
   \   000060                ; Setup parameters for call to function txCsmaGo
   \   000060   12....       LCALL   ??txCsmaGo?relay
    459            }
    460          }
   \                     ??macTxChannelBusyCallback_2:
   \   000063   02....       LJMP    ?Subroutine2 & 0xFFFF
    461          
    462          
    463          /**************************************************************************************************
    464           * @fn          macTxDoneCallback
    465           *
    466           * @brief       This callback is executed when transmit completes.
    467           *
    468           * @param       none
    469           *
    470           * @return      none
    471           **************************************************************************************************
    472           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    473          MAC_INTERNAL_API void macTxDoneCallback(void)
   \                     macTxDoneCallback:
    474          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    475            halIntState_t  s;
    476          
    477            /*
    478             *  There is a small chance this function could be called twice for a single transmit.
    479             *  To prevent logic from executing twice, the state variable macTxActive is used as
    480             *  a gating mechanism to guarantee single time execution.
    481             */
    482            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   33           RLC     A
   \   000009   FE           MOV     R6,A
   \   00000A   C2AF         CLR     0xa8.7
    483            if (macTxActive == MAC_TX_ACTIVE_GO)
   \   00000C   90....       MOV     DPTR,#macTxActive
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6483         XRL     A,#0x83
   \   000012   701E         JNZ     ??macTxDoneCallback_0
    484            {
    485              /* see if ACK was requested */
    486              if (!txAckReq)
   \   000014   90....       MOV     DPTR,#txAckReq
   \   000017   E0           MOVX    A,@DPTR
   \   000018   90....       MOV     DPTR,#macTxActive
   \   00001B   700F         JNZ     ??macTxDoneCallback_1
    487              {
    488                macTxActive = MAC_TX_ACTIVE_DONE;
   \   00001D   7485         MOV     A,#-0x7b
   \   00001F   F0           MOVX    @DPTR,A
    489                HAL_EXIT_CRITICAL_SECTION(s);
   \   000020   EE           MOV     A,R6
   \   000021   A2E0         MOV     C,0xE0 /* A   */.0
   \   000023   92AF         MOV     0xa8.7,C
    490          
    491                /* ACK was not requested, transmit is complete */
    492                txComplete(MAC_SUCCESS);
   \   000025                ; Setup parameters for call to function txComplete
   \   000025   7900         MOV     R1,#0x0
   \   000027   12....       LCALL   ??txComplete?relay
   \   00002A   800B         SJMP    ??macTxDoneCallback_2
    493              }
    494              else
    495              {
    496                /*
    497                 *  ACK was requested - must wait to receive it.  A timer is set
    498                 *  to expire after the timeout duration for waiting for an ACK.
    499                 *  If an ACK is received, the function macTxAckReceived() is called.
    500                 *  If an ACK is not received within the timeout period,
    501                 *  the function macTxAckTimeoutCallback() is called.
    502                 */
    503                macTxActive = MAC_TX_ACTIVE_LISTEN_FOR_ACK;
   \                     ??macTxDoneCallback_1:
   \   00002C   7486         MOV     A,#-0x7a
   \   00002E   F0           MOVX    @DPTR,A
    504                MAC_RADIO_TX_REQUEST_ACK_TIMEOUT_CALLBACK();
   \   00002F                ; Setup parameters for call to function macCspTxRequestAckTimeoutCallback
   \   00002F   12....       LCALL   ??macCspTxRequestAckTimeoutCallback?relay
    505                HAL_EXIT_CRITICAL_SECTION(s);
    506              }
    507            }
    508            else
    509            {
    510              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxDoneCallback_0:
   \   000032   EE           MOV     A,R6
   \   000033   A2E0         MOV     C,0xE0 /* A   */.0
   \   000035   92AF         MOV     0xa8.7,C
    511            }
    512          }
   \                     ??macTxDoneCallback_2:
   \   000037   80..         SJMP    ?Subroutine1
   \   000039                REQUIRE _A_IEN0
    513          
    514          
    515          /**************************************************************************************************
    516           * @fn          macTxAckReceivedCallback
    517           *
    518           * @brief       This function is called by the receive logic when an ACK is received and
    519           *              transmit logic is listening for an ACK.
    520           *
    521           * @param       seqn        - sequence number of received ACK
    522           * @param       pendingFlag - set if pending flag of ACK is set, cleared otherwise
    523           *
    524           * @return      none
    525           **************************************************************************************************
    526           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    527          MAC_INTERNAL_API void macTxAckReceivedCallback(uint8 seqn, uint8 pendingFlag)
   \                     macTxAckReceivedCallback:
    528          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    529            halIntState_t  s;
    530          
    531            /* only process if listening for an ACK; critical section prevents race condition problems */
    532            HAL_ENTER_CRITICAL_SECTION(s);
   \   000009   A2AF         MOV     C,0xa8.7
   \   00000B   E4           CLR     A
   \   00000C   33           RLC     A
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   C2AF         CLR     0xa8.7
    533            if (macTxActive == MAC_TX_ACTIVE_LISTEN_FOR_ACK)
   \   000011   90....       MOV     DPTR,#macTxActive
   \   000014   E0           MOVX    A,@DPTR
   \   000015   6486         XRL     A,#0x86
   \   000017   7028         JNZ     ??macTxAckReceivedCallback_0
    534            {
    535              macTxActive = MAC_TX_ACTIVE_POST_ACK;
   \   000019   7487         MOV     A,#-0x79
   \   00001B   F0           MOVX    @DPTR,A
    536              MAC_RADIO_TX_CANCEL_ACK_TIMEOUT_CALLBACK();
   \   00001C                ; Setup parameters for call to function macCspTxCancelAckTimeoutCallback
   \   00001C   12....       LCALL   ??macCspTxCancelAckTimeoutCallback?relay
    537              HAL_EXIT_CRITICAL_SECTION(s);
   \   00001F   E5..         MOV     A,?V0 + 0
   \   000021   A2E0         MOV     C,0xE0 /* A   */.0
   \   000023   92AF         MOV     0xa8.7,C
    538          
    539              /* see if the sequence number of received ACK matches sequence number of packet just sent */
    540              if (seqn == txSeqn)
   \   000025   90....       MOV     DPTR,#txSeqn
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6E           XRL     A,R6
   \   00002A   700E         JNZ     ??macTxAckReceivedCallback_1
    541              {
    542                /*
    543                 *  Sequence numbers match so transmit is successful.  Return appropriate
    544                 *  status based on the pending flag of the received ACK.
    545                 */
    546                if (pendingFlag)
   \   00002C   EF           MOV     A,R7
   \   00002D   6007         JZ      ??macTxAckReceivedCallback_2
    547                {
    548                  txComplete(MAC_ACK_PENDING);
   \   00002F                ; Setup parameters for call to function txComplete
   \   00002F   791B         MOV     R1,#0x1b
   \                     ??macTxAckReceivedCallback_3:
   \   000031   12....       LCALL   ??txComplete?relay
   \   000034   8011         SJMP    ??macTxAckReceivedCallback_4
    549                }
    550                else
    551                {
    552                  txComplete(MAC_SUCCESS);
   \                     ??macTxAckReceivedCallback_2:
   \   000036                ; Setup parameters for call to function txComplete
   \   000036   7900         MOV     R1,#0x0
   \   000038   80F7         SJMP    ??macTxAckReceivedCallback_3
    553                }
    554              }
    555              else
    556              {
    557                /* sequence number did not match; per spec, transmit failed at this point */
    558                txComplete(MAC_NO_ACK);
   \                     ??macTxAckReceivedCallback_1:
   \   00003A                ; Setup parameters for call to function txComplete
   \   00003A   79E9         MOV     R1,#-0x17
   \   00003C   12....       LCALL   ??txComplete?relay
   \   00003F   8006         SJMP    ??macTxAckReceivedCallback_4
    559              }
    560            }
    561            else
    562            {
    563              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxAckReceivedCallback_0:
   \   000041   E5..         MOV     A,?V0 + 0
   \   000043   A2E0         MOV     C,0xE0 /* A   */.0
   \   000045   92AF         MOV     0xa8.7,C
    564            }
    565          }
   \                     ??macTxAckReceivedCallback_4:
   \   000047                REQUIRE ?Subroutine1
   \   000047                REQUIRE _A_IEN0
   \   000047                ; // Fall through to label ?Subroutine1
    566          
    567          
    568          /**************************************************************************************************
    569           * @fn          macTxAckNotReceivedCallback
    570           *
    571           * @brief       This function is called by the receive logic when transmit is listening
    572           *              for an ACK but something else is received.  It is also called if the
    573           *              listen-for-ACK timeout is reached.
    574           *
    575           * @brief
    576           *
    577           * @param       none
    578           *
    579           * @return      none
    580           **************************************************************************************************
    581           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    582          MAC_INTERNAL_API void macTxAckNotReceivedCallback(void)
   \                     macTxAckNotReceivedCallback:
    583          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    584            halIntState_t  s;
    585          
    586            /* only process if listening for an ACK; critical section prevents race condition problems */
    587            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   33           RLC     A
   \   000009   FE           MOV     R6,A
   \   00000A   C2AF         CLR     0xa8.7
    588            if (macTxActive == MAC_TX_ACTIVE_LISTEN_FOR_ACK)
   \   00000C   90....       MOV     DPTR,#macTxActive
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6486         XRL     A,#0x86
   \   000012   7012         JNZ     ??macTxAckNotReceivedCallback_0
    589            {
    590              macTxActive = MAC_TX_ACTIVE_POST_ACK;
   \   000014   7487         MOV     A,#-0x79
   \   000016   F0           MOVX    @DPTR,A
    591              MAC_RADIO_TX_CANCEL_ACK_TIMEOUT_CALLBACK();
   \   000017                ; Setup parameters for call to function macCspTxCancelAckTimeoutCallback
   \   000017   12....       LCALL   ??macCspTxCancelAckTimeoutCallback?relay
    592              HAL_EXIT_CRITICAL_SECTION(s);
   \   00001A   EE           MOV     A,R6
   \   00001B   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001D   92AF         MOV     0xa8.7,C
    593          
    594              /* a non-ACK was received when expecting an ACK, per spec transmit is over at this point */
    595              txComplete(MAC_NO_ACK);
   \   00001F                ; Setup parameters for call to function txComplete
   \   00001F   79E9         MOV     R1,#-0x17
   \   000021   12....       LCALL   ??txComplete?relay
   \   000024   8005         SJMP    ??macTxAckNotReceivedCallback_1
    596            }
    597            else
    598            {
    599              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxAckNotReceivedCallback_0:
   \   000026   EE           MOV     A,R6
   \   000027   A2E0         MOV     C,0xE0 /* A   */.0
   \   000029   92AF         MOV     0xa8.7,C
    600            }
    601          }
   \                     ??macTxAckNotReceivedCallback_1:
   \   00002B   80..         SJMP    ?Subroutine1
   \   00002D                REQUIRE _A_IEN0
    602          
    603          
    604          /*=================================================================================================
    605           * @fn          txComplete
    606           *
    607           * @brief       Transmit has completed.  Perform needed maintenance and return status of
    608           *              the transmit via callback function.
    609           *
    610           * @param       status - status of the transmit that just went out
    611           *
    612           * @return      none
    613           *=================================================================================================
    614           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    615          static void txComplete(uint8 status)
   \                     txComplete:
    616          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    617            /* reset the retransmit flag */
    618            txRetransmitFlag = 0;
   \   000007   90....       MOV     DPTR,#txRetransmitFlag
   \   00000A   E4           CLR     A
   \   00000B   F0           MOVX    @DPTR,A
    619          
    620            /* update tx state; turn off receiver if nothing is keeping it on */
    621            macTxActive = MAC_TX_ACTIVE_NO_ACTIVITY;
   \   00000C   90....       MOV     DPTR,#macTxActive
   \   00000F   F0           MOVX    @DPTR,A
    622          
    623            /* turn off receive if allowed */
    624            macRxOffRequest();
   \   000010                ; Setup parameters for call to function macRxOffRequest
   \   000010   12....       LCALL   ??macRxOffRequest?relay
    625          
    626            /* update transmit power in case there was a change */
    627            macRadioUpdateTxPower();
   \   000013                ; Setup parameters for call to function macRadioUpdateTxPower
   \   000013   12....       LCALL   ??macRadioUpdateTxPower?relay
    628          
    629            /*
    630             *  Channel cannot change during transmit so update it here.  (Channel *can* change during
    631             *  a receive.  The update function resets receive logic and any partially received
    632             *  frame is purged.)
    633             */
    634            macRadioUpdateChannel();
   \   000016                ; Setup parameters for call to function macRadioUpdateChannel
   \   000016   12....       LCALL   ??macRadioUpdateChannel?relay
    635          
    636            /* return status of transmit via callback function */
    637            macTxCompleteCallback(status);
   \   000019                ; Setup parameters for call to function macTxCompleteCallback
   \   000019   EE           MOV     A,R6
   \   00001A   F9           MOV     R1,A
   \   00001B   12....       LCALL   ??macTxCompleteCallback?relay
    638          }
   \   00001E   80..         SJMP    ?Subroutine1
    639          
    640          
    641          /**************************************************************************************************
    642           * @fn          macTxTimestampCallback
    643           *
    644           * @brief       This callback function records the timestamp into the receive data structure.
    645           *              It should be called as soon as possible after there is a valid timestamp.
    646           *
    647           * @param       none
    648           *
    649           * @return      none
    650           **************************************************************************************************
    651           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    652          MAC_INTERNAL_API void macTxTimestampCallback(void)
   \                     macTxTimestampCallback:
    653          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    654            MAC_ASSERT(pMacDataTx != NULL); /* transmit structure must be there */
   \   000005   90....       MOV     DPTR,#pMacDataTx
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F8           MOV     R0,A
   \   00000A   A3           INC     DPTR
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   E8           MOV     A,R0
   \   00000E   49           ORL     A,R1
   \   00000F   7003         JNZ     ??macTxTimestampCallback_0
   \   000011                ; Setup parameters for call to function halAssertHandler
   \   000011   12....       LCALL   ??halAssertHandler?relay
    655          
    656            pMacDataTx->internal.timestamp  = macBackoffTimerCapture();
   \                     ??macTxTimestampCallback_0:
   \   000014                ; Setup parameters for call to function macBackoffTimerCapture
   \   000014   12....       LCALL   ??macBackoffTimerCapture?relay
   \   000017   8A..         MOV     ?V0 + 0,R2
   \   000019   8B..         MOV     ?V0 + 1,R3
   \   00001B   8C..         MOV     ?V0 + 2,R4
   \   00001D   8D..         MOV     ?V0 + 3,R5
   \   00001F   90....       MOV     DPTR,#pMacDataTx
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F8           MOV     R0,A
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F583         MOV     DPH,A
   \   000028   8882         MOV     DPL,R0
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?L_MOV_TO_X
    657            pMacDataTx->internal.timestamp2 = MAC_RADIO_TIMER_CAPTURE();
   \   000034                ; Setup parameters for call to function macMcuTimerCapture
   \   000034   12....       LCALL   ??macMcuTimerCapture?relay
   \   000037   8A..         MOV     ?V0 + 0,R2
   \   000039   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   E5..         MOV     A,?V0 + 0
   \   000043   F0           MOVX    @DPTR,A
   \   000044   A3           INC     DPTR
   \   000045   EB           MOV     A,R3
   \   000046   F0           MOVX    @DPTR,A
    658          }
   \   000047   7F04         MOV     R7,#0x4
   \   000049   02....       LJMP    ?BANKED_LEAVE_XDATA
    659          
    660          
    661          /**************************************************************************************************
    662           * @fn          macTxCollisionWithRxCallback
    663           *
    664           * @brief       Function called if transmit strobed on top of a receive.
    665           *
    666           * @param       none
    667           *
    668           * @return      none
    669           **************************************************************************************************
    670           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    671          MAC_INTERNAL_API void macTxCollisionWithRxCallback(void)
   \                     macTxCollisionWithRxCallback:
    672          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    673            macRxHaltCleanup();
   \   000004                ; Setup parameters for call to function macRxHaltCleanup
   \   000004   12....       LCALL   ??macRxHaltCleanup?relay
    674          }
   \   000007   02....       LJMP    ??Subroutine8_0 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for macTxSlottedDelay>`:
   \   000000   03           DB 3

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxHaltCleanup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxHaltCleanup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macWaitSendOk?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macWaitSendOk

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxFrame?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxFrame

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txCsmaPrep?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txCsmaPrep

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txGo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txGo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txCsmaGo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txCsmaGo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxFrameRetransmit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxFrameRetransmit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxStartQueuedFrame?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxStartQueuedFrame

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxChannelBusyCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxChannelBusyCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxDoneCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxDoneCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxAckReceivedCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxAckReceivedCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxAckNotReceivedCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxAckNotReceivedCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txComplete?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txComplete

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxTimestampCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxTimestampCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxCollisionWithRxCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxCollisionWithRxCallback
    675          
    676          
    677          
    678          /**************************************************************************************************
    679           *                                  Compile Time Integrity Checks
    680           **************************************************************************************************
    681           */
    682          #if (MAC_TX_ACTIVE_NO_ACTIVITY != 0x00)
    683          #error "ERROR! Zero is reserved value of macTxActive. Allows boolean operations, e.g !macTxActive."
    684          #endif
    685          
    686          /**************************************************************************************************
    687          */

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     macTxAckNotReceivedCallback        0      0      9
       -> macCspTxCancelAckTimeoutCallback
                                        0      0     18
       -> txComplete                    0      0     18
     macTxAckReceivedCallback           0      0      9
       -> macCspTxCancelAckTimeoutCallback
                                        0      0     18
       -> txComplete                    0      0     18
       -> txComplete                    0      0     18
       -> txComplete                    0      0     18
     macTxChannelBusyCallback           0      0     10
       -> halAssertHandler              0      0     20
       -> macRxOffRequest               0      0     20
       -> txComplete                    0      0     20
       -> txCsmaPrep                    0      0     20
       -> txCsmaGo                      0      0     20
     macTxCollisionWithRxCallback       2      0      0
       -> macRxHaltCleanup              4      0      0
     macTxDoneCallback                  0      0      9
       -> txComplete                    0      0     18
       -> macCspTxRequestAckTimeoutCallback
                                        0      0     18
     macTxFrame                         1      0      9
       -> halAssertHandler              0      0     18
       -> txComplete                    0      0     18
       -> macCspTxPrepSlotted           0      0     18
       -> halAssertHandler              0      0     18
       -> txCsmaPrep                    0      0     18
       -> halAssertHandler              0      0     18
       -> macMemWriteTxFifo             0      0     18
       -> txGo                          0      0     18
     macTxFrameRetransmit               2      0      0
       -> macTxFrame                    4      0      0
     macTxHaltCleanup                   2      0      0
       -> macCspTxReset                 4      0      0
     macTxInit                          2      0      0
     macTxStartQueuedFrame              2      0      0
       -> halAssertHandler              4      0      0
       -> txGo                          4      0      0
     macTxTimestampCallback             0      0     12
       -> halAssertHandler              0      0     24
       -> macBackoffTimerCapture        0      0     24
       -> macMcuTimerCapture            0      0     24
     macWaitSendOk                      2      0      0
     txComplete                         0      0     19
       -> macRxOffRequest               0      0     18
       -> macRadioUpdateTxPower         0      0     18
       -> macRadioUpdateChannel         0      0     18
       -> macTxCompleteCallback         0      0     18
     txCsmaGo                           2      0     10
       -> macDataTxTimeAvailable        4      0      0
       -> txComplete                    4      0      0
       -> macCspTxGoCsma                4      0      0
     txCsmaPrep                         0      0     20
       -> macRadioRandomByte            0      0     20
       -> macCspTxPrepCsmaSlotted       0      0     20
       -> macCspTxPrepCsmaUnslotted     0      0     20
     txGo                               2      0      9
       -> macCspTxGoSlotted             4      0      0
       -> txCsmaGo                      4      0      0


   Segment part sizes:

     Function/Label                       Bytes
     --------------                       -----
     _A_IEN0                                 1
     RFST                                    1
     macTxSlottedDelay                       1
     macTxActive                             1
     macTxType                               1
     macTxBe                                 1
     macTxCsmaBackoffDelay                   1
     nb                                      1
     txSeqn                                  1
     txAckReq                                1
     txRetransmitFlag                        1
     macTxInit                               7
     ?Subroutine0                            9
     ??Subroutine8_0                         7
     macTxHaltCleanup                       10
     macWaitSendOk                          13
     macTxFrame                            256
     ?Subroutine5                           12
     ?Subroutine6                            6
     ?Subroutine4                           12
     ?Subroutine1                            5
     ?Subroutine3                            9
     ?Subroutine7                           11
     txCsmaPrep                             43
     ?Subroutine2                            5
     txGo                                   32
     txCsmaGo                               35
     macTxFrameRetransmit                   18
     macTxStartQueuedFrame                  46
     macTxChannelBusyCallback              102
     macTxDoneCallback                      57
     macTxAckReceivedCallback               71
     macTxAckNotReceivedCallback            45
     txComplete                             32
     macTxTimestampCallback                 76
     macTxCollisionWithRxCallback           10
     ?<Initializer for macTxSlottedDelay>    1
     ??macTxInit?relay                       6
     ??macTxHaltCleanup?relay                6
     ??macWaitSendOk?relay                   6
     ??macTxFrame?relay                      6
     ??txCsmaPrep?relay                      6
     ??txGo?relay                            6
     ??txCsmaGo?relay                        6
     ??macTxFrameRetransmit?relay            6
     ??macTxStartQueuedFrame?relay           6
     ??macTxChannelBusyCallback?relay        6
     ??macTxDoneCallback?relay               6
     ??macTxAckReceivedCallback?relay        6
     ??macTxAckNotReceivedCallback?relay     6
     ??txComplete?relay                      6
     ??macTxTimestampCallback?relay          6
     ??macTxCollisionWithRxCallback?relay    6

 
 929 bytes in segment BANKED_CODE
  96 bytes in segment BANK_RELAYS
   2 bytes in segment SFR_AN
   1 byte  in segment XDATA_I
   1 byte  in segment XDATA_ID
   8 bytes in segment XDATA_Z
 
 1 026 bytes of CODE  memory
     0 bytes of DATA  memory (+ 2 bytes shared)
     9 bytes of XDATA memory

Errors: none
Warnings: none
